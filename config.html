
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Configuration &#8212; Hopic 1.59.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/banner.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Hotfix Version Requirements" href="hotfix.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="hotfix.html" title="Hotfix Version Requirements"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Hopic 1.59.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<p>The Hopic build configuration is stored in a file in your repository.
The default location where it will look for this is <code class="docutils literal notranslate"><span class="pre">${repo}/hopic-ci-config.yaml</span></code>.</p>
<div class="section" id="pre-defined-hopic-variables">
<h2>Pre-defined Hopic variables<a class="headerlink" href="#pre-defined-hopic-variables" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-workspace">
<code class="descname">WORKSPACE</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-workspace" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Contains the absolute path of the git repository in which Hopic was called.</p>
<dl class="option">
<dt id="cmdoption-arg-cfgdir">
<code class="descname">CFGDIR</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-cfgdir" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Contains the absolute path of the directory in which the <cite>hopic-ci-config.yaml</cite> file is located (this can differ from <code class="docutils literal notranslate"><span class="pre">WORKSPACE</span></code> if Hopic was called with the <code class="docutils literal notranslate"><span class="pre">--config</span></code> option).</p>
<dl class="option">
<dt id="cmdoption-arg-version">
<code class="descname">VERSION</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-version" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Contains the current version of the workspace. See <a class="reference internal" href="#id3"><code class="xref std std-option docutils literal notranslate"><span class="pre">version</span></code></a> for configuration and bump settings.
The format is based on <cite>git describe</cite> and is formatted as:</p>
<p><code class="docutils literal notranslate"><span class="pre">TAGGED_VERSION[-COMMIT_DISTANCE][.dirty.TIMESTAMP]+gCOMMIT_ID</span></code></p>
<p>For example:</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Version</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">1.8.1+g3269de8</span></code></td>
<td>tag <strong>1.8.1</strong>, clean, unmodified, <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> is at commit <strong>3269de8</strong></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">1.8.2-0.dirty.20210607131656+g3269de8</span></code></td>
<td>tag <strong>1.8.1</strong>, with uncommited changes</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">1.8.2-1+gdaffe9c</span></code></td>
<td>tag <strong>1.8.1</strong>, with one commit on top of it (<strong>-1</strong>)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">1.8.2-1.dirty.20210607131703+g4dbb6b4</span></code></td>
<td>tag <strong>1.8.1</strong>, with one commit on top of it, as well as uncommitted changes</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When the current <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> is <em>dirty</em> or does not have a version tag, the latest tag does not uniquely describe <code class="docutils literal notranslate"><span class="pre">HEAD</span></code>.</p>
<p class="last">This is technically a “post-release” of the last tag. To implement this, Hopic will define the version as a <strong>pre-release</strong> for the <strong>next patch-version</strong>, using the commit distance to the latest tag as the pre-release identifier.
This is the closest approximation of a “post-release” while still remaining SemVer-compliant in format as well as version precedence.</p>
</div>
<p>Since the ‘pre-release-behavior’ can be experienced as non-intuitive, an extra example is provided below.</p>
<p>Consider the following repository history:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ea47ce2 (HEAD -&gt; master) test: add extra unit test for feature X</span>
<span class="go">9f8f270 ci: add ci configuration</span>
<span class="go">fe6b6fa (tag: 0.1.0) feat: add feature X</span>
<span class="go">cd0aec6 (tag: 0.0.1) chore: initial commit</span>
</pre></div>
</div>
<p>The latest tag for this repository is <strong>0.1.0</strong>. However, since two non-bumping commits were done on top of that tag, the tag <strong>0.1.0</strong> no longer uniquely describes the code in the repository.
The version for <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> will therefore be a pre-release for the next patch commit, the pre-release field being defined as the distance to that last tag: <strong>0.1.1-2</strong>.</p>
<p>When a <code class="docutils literal notranslate"><span class="pre">fix</span></code>-commit is submitted thereafter, the version will be bumped to <strong>0.1.1</strong>.
This version, not being a pre-release (that is, not containing a hyphen: <code class="docutils literal notranslate"><span class="pre">-</span></code>), has a higher precedence than any previously published pre-release version (<strong>0.1.1-N</strong>).</p>
<dl class="option">
<dt id="cmdoption-arg-pure-version">
<code class="descname">PURE_VERSION</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-pure-version" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Contains the <a class="reference internal" href="#cmdoption-arg-version"><code class="xref std std-option docutils literal notranslate"><span class="pre">VERSION</span></code></a> (see above), but without <code class="docutils literal notranslate"><span class="pre">build</span> <span class="pre">metadata</span></code> (everything after the <code class="docutils literal notranslate"><span class="pre">+</span></code>).</p>
<p>For example:</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Version</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">1.8.1</span></code></td>
<td>tag <strong>1.8.1</strong>, clean, unmodified</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">1.8.2-0.dirty.20200609131656</span></code></td>
<td>tag <strong>1.8.1</strong>, with uncommited changes</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">1.8.2-1</span></code></td>
<td>tag <strong>1.8.1</strong>, with one commit on top of it</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">1.8.2-1.dirty.20200609152429</span></code></td>
<td>tag <strong>1.8.1</strong>, with one commit on top of it, as well as uncommitted changes</td>
</tr>
</tbody>
</table>
<dl class="option">
<dt id="cmdoption-arg-debversion">
<code class="descname">DEBVERSION</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-debversion" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Contains a Debian version-compliant representation of the <a class="reference internal" href="#cmdoption-arg-version"><code class="xref std std-option docutils literal notranslate"><span class="pre">VERSION</span></code></a> as outlined above.
Its specification can be found at: <a class="reference external" href="https://www.debian.org/doc/debian-policy/ch-controlfields.html#version">https://www.debian.org/doc/debian-policy/ch-controlfields.html#version</a></p>
<p>For example:</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Version</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">1.8.1+g3269de8</span></code></td>
<td>tag <strong>1.8.1</strong>, clean, unmodified, <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> is at commit <strong>3269de8</strong></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">1.8.2~0+dirty20200609131656+g3269de8</span></code></td>
<td>tag <strong>1.8.1</strong>, with uncommited changes</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">1.8.2~1+gdaffe9c</span></code></td>
<td>tag <strong>1.8.1</strong>, with one commit on top of it (<strong>~1</strong>)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">1.8.2~1+dirty20200609152429+g4dbb6b4</span></code></td>
<td>tag <strong>1.8.1</strong>, with one commit on top of it, as well as uncommitted changes</td>
</tr>
</tbody>
</table>
<dl class="option">
<dt id="cmdoption-arg-publish-version">
<code class="descname">PUBLISH_VERSION</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-publish-version" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Based on the <a class="reference internal" href="#cmdoption-arg-version"><code class="xref std std-option docutils literal notranslate"><span class="pre">VERSION</span></code></a> (see above) by default, with the following differences:</p>
<ul class="simple">
<li>Where <code class="docutils literal notranslate"><span class="pre">COMMIT_ID</span></code> is part part of the <code class="docutils literal notranslate"><span class="pre">prerelease</span></code> (<code class="docutils literal notranslate"><span class="pre">-COMMIT_ID</span></code>) instead of <code class="docutils literal notranslate"><span class="pre">build</span> <span class="pre">metadata</span></code> (<code class="docutils literal notranslate"><span class="pre">+gCommit_ID</span></code>)</li>
<li>Where <code class="docutils literal notranslate"><span class="pre">build</span></code> is present in the <a class="reference internal" href="#versioning">Versioning</a> configuration this is added, e.g. <code class="docutils literal notranslate"><span class="pre">+build</span></code> (only to <code class="docutils literal notranslate"><span class="pre">PUBLISH_VERSION</span></code>)</li>
</ul>
<p>During a build that is publishing, this is based on <a class="reference internal" href="#cmdoption-arg-pure-version"><code class="xref std std-option docutils literal notranslate"><span class="pre">PURE_VERSION</span></code></a>.
Currently the version <code class="docutils literal notranslate"><span class="pre">build</span></code> property only affects <code class="docutils literal notranslate"><span class="pre">PUBLISH_VERSION</span></code>.
The <code class="docutils literal notranslate"><span class="pre">build</span></code> property value is appended to the build metadata.</p>
<p>Some package managers (e.g Maven) do not correctly implement SemVer 2.0.0.
Those package managers fail to perform range checks with a ‘build metadata’ component, because they treat the build metadata as an alphanumeric part of the version instead of ignoring it.</p>
<dl class="option">
<dt id="cmdoption-arg-git-commit">
<code class="descname">GIT_COMMIT</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-git-commit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">GIT_COMMIT</span></code> contains the full commit hash of the current commit, also known symbolically as <code class="docutils literal notranslate"><span class="pre">HEAD</span></code>.</p>
<dl class="option">
<dt id="cmdoption-arg-git-commit-time">
<code class="descname">GIT_COMMIT_TIME</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-git-commit-time" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">GIT_COMMIT_TIME</span></code> contains the committer time of <a class="reference internal" href="#cmdoption-arg-git-commit"><code class="xref std std-option docutils literal notranslate"><span class="pre">GIT_COMMIT</span></code></a> formatted according to <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc3339.html"><strong>RFC 3339</strong></a>.</p>
<dl class="option">
<dt id="cmdoption-arg-git-branch">
<code class="descname">GIT_BRANCH</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-git-branch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><em>Iff</em> the current repository was checked out from a branch with <code class="docutils literal notranslate"><span class="pre">checkout-source-tree</span></code> then <code class="docutils literal notranslate"><span class="pre">GIT_BRANCH</span></code> will contain that branch’s name.</p>
<dl class="option">
<dt id="cmdoption-arg-build-name">
<code class="descname">BUILD_NAME</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-build-name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">BUILD_NAME</span></code> will contain the same value as the same named environment variable, if it exists.
If that environment variable doesn’t exist it will default to <code class="docutils literal notranslate"><span class="pre">&quot;unknown&quot;</span></code>.
On Jenkins that environment variable will contain the “job name”.</p>
<dl class="option">
<dt id="cmdoption-arg-build-number">
<code class="descname">BUILD_NUMBER</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-build-number" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">BUILD_NUMBER</span></code> will contain the same value as the same named environment variable, if it exists.
If that environment variable doesn’t exist it will default to <code class="docutils literal notranslate"><span class="pre">&quot;NaN&quot;</span></code>.
On Jenkins that environment variable will contain the “build number”.
For pull-requests that build number will be prefixed with “PR-&lt;n&gt;”, e.g. “PR-123 42”.</p>
<dl class="option">
<dt id="cmdoption-arg-build-url">
<code class="descname">BUILD_URL</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-build-url" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">BUILD_URL</span></code> will contain the same value as the same named environment variable, if it exists.
If that environment variable doesn’t exist it will default to to the empty string.
On Jenkins it will contain the URL for the build’s overview page.</p>
<p>During a build the following configuration variables are available.</p>
<dl class="option">
<dt id="cmdoption-arg-build-duration">
<code class="descname">BUILD_DURATION</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-build-duration" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">BUILD_DURATION</span></code> will contain the amount of seconds passed since <code class="docutils literal notranslate"><span class="pre">GIT_COMMIT_TIME</span></code>.
Under the assumption that <code class="docutils literal notranslate"><span class="pre">GIT_COMMIT_TIME</span></code> is (close enough) to the start of the build this represents the time the build has taken so far.</p>
<dl class="option">
<dt id="cmdoption-arg-hopic-phase">
<code class="descname">HOPIC_PHASE</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-hopic-phase" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">HOPIC_PHASE</span></code> will contain the name of the current executing phase.
This name is only available during phases specified within <code class="docutils literal notranslate"><span class="pre">phases</span></code>!</p>
<dl class="option">
<dt id="cmdoption-arg-hopic-variant">
<code class="descname">HOPIC_VARIANT</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-hopic-variant" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">HOPIC_VARIANT</span></code> will contain the name of the current executing variant.
This name is only available during variants specified within <code class="docutils literal notranslate"><span class="pre">phases</span></code>!</p>
</div>
<div class="section" id="pre-defined-environment-variables">
<h2>Pre-defined environment variables<a class="headerlink" href="#pre-defined-environment-variables" title="Permalink to this headline">¶</a></h2>
<p>The <strong>VERSION</strong>, <strong>PURE_VERSION</strong>, <strong>DEBVERSION</strong> and <strong>PUBLISH_VERSION</strong> variables (documented above) are also available in the environment of any process spawned by Hopic.</p>
</div>
<div class="section" id="build-phases">
<h2>Build Phases<a class="headerlink" href="#build-phases" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-phases">
<code class="descname">phases</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-phases" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Hopic’s build flow is divided in <code class="docutils literal notranslate"><span class="pre">phases</span></code>, during which a set of commands can be executed for different <code class="docutils literal notranslate"><span class="pre">variants</span></code>.
The <a class="reference internal" href="#cmdoption-arg-phases"><code class="xref std std-option docutils literal notranslate"><span class="pre">phases</span></code></a> option is a dictionary of dictionaries.
It’s top-level key specifies the name of each phase.
The keys within each phase specify the names of variants to be executed within that phase.
Note that the variant name <code class="docutils literal notranslate"><span class="pre">post-submit</span></code> is reserved for internal use and is not permitted to be specified by users.</p>
<p>Phases are executed in the order in which they appear in the configuration.
Within a phase each variant may be executed in parallel, possibly on different executors.
Every next phase only starts executing when each variant within the previous phase finished successfully.
I.e. the execution flow “forks” to each variant at the start of a phase and “joins” at the end.</p>
<p>A variant, identified by its name, may appear in multiple phases.
Variants appearing in multiple phases are guaranteed to run on the same executor within each phase.
This provides a stable environment (workspace) to work in and allows incremental steps, such as building in phase A and running built tests in phase B.</p>
<p>For example, the configuration example listed results in an execution flow as shown after that.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">style</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">commit-message-checker</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Require each commit message to adhere to our requirements</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">foreach</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AUTOSQUASHED_COMMIT</span><span class="w"></span>
<span class="w">        </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.ci/verify-commit-message.py ${AUTOSQUASHED_COMMIT}</span><span class="w"></span>
<span class="w">    </span><span class="nt">clang-format</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Show all changes necessary to have each commit formatted properly</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">foreach</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AUTOSQUASHED_COMMIT</span><span class="w"></span>
<span class="w">        </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GIT_PAGER=&quot;tee ${AUTOSQUASHED_COMMIT}.format.diff&quot; git clang-format --style=file --diff ${AUTOSQUASHED_COMMIT}~1 ${AUTOSQUASHED_COMMIT}</span><span class="w"></span>
<span class="w">      </span><span class="c1"># Assert that no changes were necessary</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">foreach</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AUTOSQUASHED_COMMIT</span><span class="w"></span>
<span class="w">        </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;test</span><span class="nv"> </span><span class="s">!</span><span class="nv"> </span><span class="s">-s</span><span class="nv"> </span><span class="s">${AUTOSQUASHED_COMMIT}.format.diff&#39;</span><span class="w"></span>

<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake -B build-x64-release -S . -DCMAKE_BUILD_TYPE=RelWithDebInfo</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-release</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-debug</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake -B build-x64-debug -S . -DCMAKE_BUILD_TYPE=Debug</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-debug</span><span class="w"></span>
<span class="w">    </span><span class="nt">arm64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake -B build-arm64-release -S . -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_TOOLCHAIN_FILE:PATH=${CMAKE_AGL_AARCH64_TOOLCHAIN_FILE}</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-arm64-release</span><span class="w"></span>
<span class="w">    </span><span class="nt">arm64-debug</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake -B build-arm64-debug -S . -DCMAKE_BUILD_TYPE=Debug -DCMAKE_TOOLCHAIN_FILE:PATH=${CMAKE_AGL_AARCH64_TOOLCHAIN_FILE}</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-arm64-debug</span><span class="w"></span>

<span class="w">  </span><span class="nt">test</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-debug</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">junit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x64-debug/test-unit.xml</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-debug --target test</span><span class="w"></span>

<span class="w">  </span><span class="nt">package</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">fingerprint</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x64-release/TomTom-Stacktrace-${VERSION}-Linux-x86_64.tar.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-release --target package</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-debug</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">fingerprint</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x64-debug/TomTom-Stacktrace-${VERSION}-Linux-x86_64.tar.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-debug --target package</span><span class="w"></span>
<span class="w">    </span><span class="nt">arm64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">fingerprint</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-arm64-release/TomTom-Stacktrace-${VERSION}-Linux-aarch64.tar.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-arm64-release --target package</span><span class="w"></span>
<span class="w">    </span><span class="nt">arm64-debug</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">fingerprint</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-arm64-debug/TomTom-Stacktrace-${VERSION}-Linux-aarch64.tar.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-arm64-debug --target package</span><span class="w"></span>

<span class="w">  </span><span class="nt">upload</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">only</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x64-release/do-upload.sh</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-debug</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">only</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x64-debug/do-upload.sh</span><span class="w"></span>
<span class="w">    </span><span class="nt">arm64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">only</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-arm64-release/do-upload.sh</span><span class="w"></span>
<span class="w">    </span><span class="nt">arm64-debug</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">only</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-arm64-debug/do-upload.sh</span><span class="w"></span>
</pre></div>
</div>
<div class="figure" id="id5">
<img alt="_images/parallel-phases.svg" src="_images/parallel-phases.svg" /><p class="caption"><span class="caption-text">Example execution flow of a Hopic build configuration.</span></p>
</div>
</div>
<div class="section" id="post-submission-phases">
<h2>Post Submission Phases<a class="headerlink" href="#post-submission-phases" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-post-submit">
<code class="descname">post-submit</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-post-submit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Optionally, as part of the submission, Hopic provides the opportunity to execute another list of phases.
These will be executed during the <code class="docutils literal notranslate"><span class="pre">submit</span></code> subcommand, but just after the actual submission to the revision control system has been performed.
The <a class="reference internal" href="#cmdoption-arg-post-submit"><code class="xref std std-option docutils literal notranslate"><span class="pre">post-submit</span></code></a> option is a dictionary of phases.
The keys specify the name of each phase.</p>
<p>The content of each phase has the same syntax, and is interpreted the same, as the content of a variant for <a class="reference internal" href="#cmdoption-arg-phases"><code class="xref std std-option docutils literal notranslate"><span class="pre">phases</span></code></a>.
Only the following subset of options however, is permitted to be used within these phases:</p>
<ul class="simple">
<li><a class="reference internal" href="#cmdoption-arg-description"><code class="xref std std-option docutils literal notranslate"><span class="pre">description</span></code></a></li>
<li><a class="reference internal" href="#cmdoption-arg-docker-in-docker"><code class="xref std std-option docutils literal notranslate"><span class="pre">docker-in-docker</span></code></a></li>
<li><a class="reference internal" href="#cmdoption-arg-image"><code class="xref std std-option docutils literal notranslate"><span class="pre">image</span></code></a></li>
<li><a class="reference internal" href="#cmdoption-arg-node-label"><code class="xref std std-option docutils literal notranslate"><span class="pre">node-label</span></code></a></li>
<li><a class="reference internal" href="#cmdoption-arg-run-on-change"><code class="xref std std-option docutils literal notranslate"><span class="pre">run-on-change</span></code></a></li>
<li><code class="xref std std-option docutils literal notranslate"><span class="pre">sh</span></code></li>
<li><a class="reference internal" href="#cmdoption-arg-timeout"><code class="xref std std-option docutils literal notranslate"><span class="pre">timeout</span></code></a></li>
<li><a class="reference internal" href="#cmdoption-arg-volumes"><code class="xref std std-option docutils literal notranslate"><span class="pre">volumes</span></code></a></li>
<li><a class="reference internal" href="#cmdoption-arg-with-credentials"><code class="xref std std-option docutils literal notranslate"><span class="pre">with-credentials</span></code></a></li>
</ul>
<p>The <a class="reference internal" href="#cmdoption-arg-node-label"><code class="xref std std-option docutils literal notranslate"><span class="pre">node-label</span></code></a> option has an additional restriction.
If specified multiple times, it is only allowed to contain the same value for each location it is specified.
This is necessary to keep the complexity, and thus chance of failure, of the <code class="docutils literal notranslate"><span class="pre">submit</span></code> command low.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">tag</span><span class="p">:</span><span class="w">    </span><span class="s">&#39;v{version.major}.{version.minor}.{version.patch}&#39;</span><span class="w"></span>
<span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">semver</span><span class="w"></span>
<span class="w">  </span><span class="nt">bump</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conventional-commits</span><span class="w"></span>
<span class="w">    </span><span class="nt">strict</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">    </span><span class="nt">on-every-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>

<span class="nt">project-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PIPE</span><span class="w"></span>

<span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">style</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">flake8</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tox -e flake8</span><span class="w"></span>

<span class="w">  </span><span class="nt">test</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">python3.8</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tox -r -e py38</span><span class="w"></span>

<span class="nt">post-submit</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">publish</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">new-version-only</span><span class="w"></span>
<span class="w">      </span><span class="nt">with-credentials</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pypi</span><span class="w"></span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">username-password</span><span class="w"></span>
<span class="w">      </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tox -e publish</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="environment">
<h2>Environment<a class="headerlink" href="#environment" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-environment">
<code class="descname">environment</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-environment" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Sometimes it’s necessary to execute a command with altered environment variables.
For that purpose it’s possible to use leading <code class="docutils literal notranslate"><span class="pre">name=value</span></code> words in the <code class="xref std std-option docutils literal notranslate"><span class="pre">sh</span></code> command.
This requires shell escaping and because of that may not always be convenient enough to use.
To address this command entries may instead use the <code class="docutils literal notranslate"><span class="pre">environment</span></code> option.
Note that using the <code class="docutils literal notranslate"><span class="pre">environment</span></code> option disables processing of leading <code class="docutils literal notranslate"><span class="pre">name=value</span></code> words.</p>
<p>This option specifies a mapping of environment variables and the values to override them with for the current command only.
The <code class="docutils literal notranslate"><span class="pre">null</span></code> value can be used to require removal of the specified environment variable.
This is different from specifying the empty string which will still allow the environment variable to exist (but be empty).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">a</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># leading name=value environment variable overrides</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ENV_1=one ENV_2=&quot;two and three&quot; ./command.sh --option=four</span><span class="w"></span>
<span class="w">      </span><span class="c1"># explicit environment mapping override</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">environment</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">ENV_1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">one</span><span class="w"></span>
<span class="w">          </span><span class="nt">ENV_2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">two and three</span><span class="w"></span>
<span class="w">          </span><span class="nt">SOURCE_DATE_EPOCH</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="w">        </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./command.sh --option=four</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="ci-locks">
<h2>CI-locks<a class="headerlink" href="#ci-locks" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-ci-locks">
<code class="descname">ci-locks</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-ci-locks" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>When within a Hopic file multiple git repo’s are changed and submitted it might be required to have a lock on every git repo.
The current repo where Hopic is used is automatically protected with a lock.
The :option: <cite>ci-locks</cite> option can be used to specify additional repositories whose locks should be acquired during the merge submit flow.
This assumes that the other git repo’s are protected with a named lock while merging a change.</p>
<p><a class="reference internal" href="#cmdoption-arg-ci-locks"><code class="xref std std-option docutils literal notranslate"><span class="pre">ci-locks</span></code></a> requires a list of of <code class="docutils literal notranslate"><span class="pre">branch</span></code> and <code class="docutils literal notranslate"><span class="pre">repo-name</span></code>:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code></dt>
<dd>Target git branch name that needs to be protected</dd>
<dt><code class="docutils literal notranslate"><span class="pre">repo-name</span></code></dt>
<dd>Target git repo-name that needs to be protected</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lock-on-change</span></code> (optional)</dt>
<dd><dl class="first last docutils">
<dt>Specifies when additional lock is acquired. Can only be one of the following values:</dt>
<dd><ul class="first last simple">
<li><em>always</em> (default)</li>
<li><em>never</em></li>
<li><em>new-version-only</em> (only acquire lock when version is bumped)</li>
</ul>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">from-phase-onward</span></code> (optional)</dt>
<dd>Acquire the lock only at the start of the specified phase
By default it would be acquired at the start of the build instead.</dd>
</dl>
<p>The named lock that Hopic will acquire is formatted as <code class="docutils literal notranslate"><span class="pre">repo-name</span></code>/<code class="docutils literal notranslate"><span class="pre">branch</span></code>
If all merge checks pass and Hopic is going to submit the merge, all specified addition locks will be acquired at the beginning of a build, alongside the repository’s own lock.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ci-locks</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;master&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">repo-name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PIPE/ci-lock&quot;</span><span class="w"></span>

<span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">phase-1</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">variant-1</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;mkdir -p /tmp/ci-lock-dir &amp;&amp; cd /tmp/ci-lock-dir &amp;&amp; git init&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">touch new_file.txt</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;git add new_file.txt &amp;&amp; git commit -m &#39;add new_file&#39;&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rm -r /tmp/ci-lock-dir</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="clean">
<h2>Clean<a class="headerlink" href="#clean" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-clean">
<code class="descname">clean</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-clean" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Hopic provides built-in clean check-out functionality by executing <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clean</span> <span class="pre">-fxd</span></code> on the <code class="docutils literal notranslate"><span class="pre">${WORKSPACE}</span></code>.
It is possible to add a list of commands that is executed before the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clean</span> <span class="pre">-fxd</span></code> is executed.
Within the list of commands <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> and <code class="docutils literal notranslate"><span class="pre">~</span></code> will be expanded to the home directory of the current user.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">clean</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rm -rf ~/.cache</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rm -rf ${HOME}/.other_cache</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="config">
<h2>Config<a class="headerlink" href="#config" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-config">
<code class="descname">config</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-config" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Some features in Hopic are using YAML’s <a class="reference external" href="https://yaml.org/spec/1.1/#id858600">explicit tags</a> functionality to support custom defined YAML parsing behavior.
Features that use this functionality can be recognized by <code class="docutils literal notranslate"><span class="pre">&lt;dict_key&gt;:</span> <span class="pre">!&lt;custom_function&gt;</span></code>.
Since explicit tags need to be specified as a value of a dictonary, the <code class="docutils literal notranslate"><span class="pre">config</span></code> is introduced to specify explicit tags on the top level.
<code class="docutils literal notranslate"><span class="pre">config</span></code> transparently adds a top level dictionary which allows making a global explicit tag.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pip</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">with-extra-index</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://test.pypi.org/simple</span><span class="w"></span>
<span class="w">    </span><span class="nt">packages</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hopic-templates-test[full-pipeline-template]&gt;=0.2.3,&lt;1</span><span class="w"></span>
<span class="w">        </span>
<span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="kt">!template</span><span class="w"> </span><span class="s">&quot;full-pipeline-template&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="credentials">
<h2>Credentials<a class="headerlink" href="#credentials" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-with-credentials">
<code class="descname">with-credentials</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-with-credentials" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Sometimes it’s necessary to execute commands with privileged access.
For that purpose the <a class="reference internal" href="#cmdoption-arg-with-credentials"><code class="xref std std-option docutils literal notranslate"><span class="pre">with-credentials</span></code></a> configuration option can be used for a variant within a phase.
You need to specify an identifier (<code class="docutils literal notranslate"><span class="pre">id</span></code>), used for looking up the credential and its type (<code class="docutils literal notranslate"><span class="pre">type</span></code>).
In addition to that you can specify the name of the config and environment variable that should be set to contain them.
<a class="reference internal" href="#cmdoption-arg-with-credentials"><code class="xref std std-option docutils literal notranslate"><span class="pre">with-credentials</span></code></a> value can be specified as a list to have multiple credentials for a variant within a phase.
Username/password credentials can be optionally encoded for use in a url by configuring encoding to (<code class="docutils literal notranslate"><span class="pre">url</span></code>).</p>
<p>The supported types of credential are:</p>
<div class="section" id="username-password-credential">
<h3>Username/password credential<a class="headerlink" href="#username-password-credential" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">type</span></code>: <code class="docutils literal notranslate"><span class="pre">username-password</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">username-variable</span></code> default: <code class="docutils literal notranslate"><span class="pre">USERNAME</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">password-variable</span></code> default: <code class="docutils literal notranslate"><span class="pre">PASSWORD</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">encoding</span></code>: default: <code class="docutils literal notranslate"><span class="pre">plain</span></code></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="file-credential">
<h3>File credential<a class="headerlink" href="#file-credential" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">type</span></code>: <code class="docutils literal notranslate"><span class="pre">file</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">filename-variable</span></code> default: <code class="docutils literal notranslate"><span class="pre">SECRET_FILE</span></code></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="string-credential">
<h3>String credential<a class="headerlink" href="#string-credential" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">type</span></code>: <code class="docutils literal notranslate"><span class="pre">string</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">string-variable</span></code> default: <code class="docutils literal notranslate"><span class="pre">SECRET</span></code></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="ssh-key-credential">
<h3>SSH key credential<a class="headerlink" href="#ssh-key-credential" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">type</span></code>: <code class="docutils literal notranslate"><span class="pre">ssh-key</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ssh-command-variable</span></code> default: <code class="docutils literal notranslate"><span class="pre">SSH</span></code></li>
</ul>
</div></blockquote>
<p>This provides, in the variable specified by <code class="docutils literal notranslate"><span class="pre">ssh-command-variable</span></code>, an executable that will behave like <code class="docutils literal notranslate"><span class="pre">ssh</span></code>.
It will however be pre-authenticated with the credential’s SSH key and, if known, associated user.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">download</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">toolchain</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">with-credentials</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">access_key</span><span class="w"></span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">download --api-key=${SECRET}</span><span class="w"></span>

<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">toolchain</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">with-credentials</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">license_file</span><span class="w"></span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build --license-key=${SECRET_FILE}</span><span class="w"></span>

<span class="w">  </span><span class="nt">test</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">toolchain</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">with-credentials</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">squish_cred</span><span class="w"></span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">username-password</span><span class="w"></span>
<span class="w">            </span><span class="nt">username-variable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SQUISH_USERNAME</span><span class="w"></span>
<span class="w">            </span><span class="nt">password-variable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SQUISH_PASSWORD</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">artifactory_creds</span><span class="w"></span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">username-password</span><span class="w"></span>
<span class="w">            </span><span class="nt">username-variable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ARTIFACTORY_USERNAME</span><span class="w"></span>
<span class="w">            </span><span class="nt">password-variable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ARTIFACTORY_PASSWORD</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">download test-certificate --username=${ARTIFACTORY_USERNAME} --password=${ARTIFACTORY_PASSWORD}</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test --username=${SQUISH_USERNAME} --password=${SQUISH_PASSWORD}</span><span class="w"></span>

<span class="w">  </span><span class="nt">deploy</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">toolchain</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">only</span><span class="w"></span>
<span class="w">        </span><span class="nt">with-credentials</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">artifactory_creds</span><span class="w"></span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">username-password</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">publish --user=${USERNAME} --password=${PASSWORD}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="keyring-support">
<h3>Keyring Support<a class="headerlink" href="#keyring-support" title="Permalink to this headline">¶</a></h3>
<p>For local, interactive, use Hopic also supports credentials stored in your keyring using the <a class="reference external" href="https://pypi.org/project/keyring/">keyring</a> library.
Note that <code class="docutils literal notranslate"><span class="pre">keyring</span></code> is only an optional dependency of Hopic and will only get installed when the <code class="docutils literal notranslate"><span class="pre">interactive</span></code> extra feature is selected.</p>
<p>If you didn’t install Hopic with the <code class="docutils literal notranslate"><span class="pre">interactive</span></code> feature you can either reinstall it or install the <code class="docutils literal notranslate"><span class="pre">keyring</span></code> library yourself.
Note on macOS you will also need to install the <code class="docutils literal notranslate"><span class="pre">netstruct</span></code> library.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pip3 install keyring</span>
</pre></div>
</div>
<p>This has been tested and confirmed to work with at least these keyring implementations:</p>
<ul class="simple">
<li>gnome-keyring-daemon: GNOME’s builtin keyring</li>
<li>KeepassXC 2.6</li>
</ul>
<dl class="option">
<dt id="cmdoption-arg-project-name">
<code class="descname">project-name</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-project-name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>If properly configured, Hopic will attempt to obtain all <code class="docutils literal notranslate"><span class="pre">username-password</span></code> credentials used during execution from your keyring.
In order to do that, Hopic needs to know a project scope within which to look for your credentials.
This scope can be configured with the <code class="docutils literal notranslate"><span class="pre">project-name</span></code> option.
We suggest using your projects Jira keyword for this purpose as it’s the most likely to be unique enough.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">project-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">JIRA_KEY</span><span class="w"></span>

<span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">deploy</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">toolchain</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">only</span><span class="w"></span>
<span class="w">        </span><span class="nt">with-credentials</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">artifactory-creds</span><span class="w"></span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">username-password</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">publish --user=${USERNAME} --password=${PASSWORD}</span><span class="w"></span>
</pre></div>
</div>
<p>This example will cause Hopic to look for a credential with a value for the <code class="docutils literal notranslate"><span class="pre">service</span></code> field of <code class="docutils literal notranslate"><span class="pre">JIRA_KEY-artifactory-creds</span></code>.
When found, it will use its <code class="docutils literal notranslate"><span class="pre">username</span></code> and <code class="docutils literal notranslate"><span class="pre">password</span></code> fields for the <code class="docutils literal notranslate"><span class="pre">publish</span></code> command.</p>
<p>When Hopic doesn’t find the credential in the keyring, its behavior depends on whether it’s running in an interactive terminal or not.</p>
<p>When Hopic runs in an interactive terminal, it will prompt the user for the username and password.
It will store these in your keyring and continue execution with those values.</p>
<p>When Hopic doesn’t run in an interactive terminal, like on your CI system, it will attempt to obtain the credentials from your CI system’s credential store.
The <a class="reference internal" href="#cmdoption-arg-project-name"><code class="xref std std-option docutils literal notranslate"><span class="pre">project-name</span></code></a> will not be taken into account when looking in the CI system’s credential store.
That option applies to keyring lookups only.
If it cannot find them there, it will fail with an error message indicating it couldn’t find the specific credential.</p>
</div>
</div>
<div class="section" id="container-image">
<h2>Container Image<a class="headerlink" href="#container-image" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-image">
<code class="descname">image</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-image" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>In order to execute commands within a Docker container Hopic needs to be told what image to use for creating a container.
This option can either contain a string in which case every variant will execute in a container constructed from that image.
Alternatively it can contain a mapping where the keys and values are the names of the variant and the image to execute those in respectively.
If using the mapping form, the <code class="docutils literal notranslate"><span class="pre">default</span></code> key will be used for variants that don’t have an image specified explicitly.
The image can also be specified within a phase for a variant, this will override the global specified image for the specific variant for only the phase where it is specified.</p>
<p>An example of the mapping style where two different variants are executed in containers based on different images:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">image</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">buildpack-deps:testing</span><span class="w"></span>
<span class="w">  </span><span class="nt">whoami</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">buildpack-deps:testing-curl</span><span class="w"></span>

<span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">prepare</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">hello</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cc -o hello hello.c</span><span class="w"></span>
<span class="w">    </span><span class="nt">whoami</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">curl --output ip-address.txt https://api.ipify.org</span><span class="w"></span>

<span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">hello</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">busybox:latest</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hello</span><span class="w"></span>
</pre></div>
</div>
<p>For the purpose of using an image (name and version) specified in an Ivy dependency manifest file the <cite>!image-from-ivy-manifest</cite> type constructor exists.
When used its contents are a mapping with these keys:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">manifest</span></code></dt>
<dd><p class="first">Path to the Ivy manifest file.
Relative paths are interpreted relative to the first of the ${CFGDIR} or ${WORKSPACE} directories that exists.
This defaults to the first of these to exist:</p>
<ul class="last simple">
<li><code class="docutils literal notranslate"><span class="pre">${WORKSPACE}/dependency_manifest.xml</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">${CFGDIR}/dependency_manifest.xml</span></code></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">repository</span></code></dt>
<dd>Docker repository to fetch the image from.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">path</span></code></dt>
<dd>Directory within the repository to fetch from.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>Name of the image to fetch.
This defaults to the content of the <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute in the Ivy manifest.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rev</span></code></dt>
<dd>Version of the image to fetch.
This defaults to the content of the <code class="docutils literal notranslate"><span class="pre">rev</span></code> attribute in the ivy manifest.</dd>
</dl>
<p>When used this will get treated as if the expansion of <code class="docutils literal notranslate"><span class="pre">{repository}/{path}/{name}:{rev}</span></code> was specified as a string value of this field.
This allows using Ivy as a mechanism for automatically keeping the Docker image up to date.</p>
<p>For example, when using this dependency manifest in <code class="docutils literal notranslate"><span class="pre">${WORKSPACE}/dependency_manifest.xml</span></code>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ivy-module</span> <span class="na">version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;info</span> <span class="na">module=</span><span class="s">&quot;p1cms&quot;</span> <span class="na">organisation=</span><span class="s">&quot;com.tomtom&quot;</span> <span class="na">revision=</span><span class="s">&quot;dont-care&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency</span> <span class="na">name=</span><span class="s">&quot;python&quot;</span> <span class="na">org=</span><span class="s">&quot;com.tomtom.toolchains&quot;</span> <span class="na">rev=</span><span class="s">&quot;3.6.5&quot;</span> <span class="na">revConstraint=</span><span class="s">&quot;[3.5,4.0[&quot;</span><span class="nt">&gt;</span>
      <span class="cm">&lt;!-- identify this as the dependency specifying the Docker image for Hopic --&gt;</span>
      <span class="nt">&lt;conf</span> <span class="na">mapped=</span><span class="s">&quot;toolchain&quot;</span> <span class="na">name=</span><span class="s">&quot;default&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/ivy-module&gt;</span>
</pre></div>
</div>
<p>And this Hopic config file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">image</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="kt">!image-from-ivy-manifest</span><span class="w"></span>
<span class="w">    </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hub.docker.com</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tomtom</span><span class="w"></span>
<span class="w">  </span><span class="nt">Linux_AGL-aarch64</span><span class="p">:</span><span class="w"> </span><span class="kt">!image-from-ivy-manifest</span><span class="w"></span>
<span class="w">    </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hub.docker.com</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tomtom</span><span class="w"></span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agl-build-aarch64-toolchain</span><span class="w"></span>
</pre></div>
</div>
<p>The result will be to use the <code class="docutils literal notranslate"><span class="pre">hub.docker.com/tomtom/python:3.6.5</span></code> image by default.
The <code class="docutils literal notranslate"><span class="pre">PyPy</span></code> build will instead use the <code class="docutils literal notranslate"><span class="pre">hub.docker.com/tomtom/pypy:3.6.5</span></code> image.
I.e. for that build the image name is overridden from that used in the Ivy manifest, while still using the version from it.</p>
</div>
<div class="section" id="extra-docker-arguments">
<h2>Extra Docker arguments<a class="headerlink" href="#extra-docker-arguments" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-extra-docker-args">
<code class="descname">extra-docker-args</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-extra-docker-args" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>There is a limited subset of <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> arguments that can be specified for a variant:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">add-host</span></code></dt>
<dd>This options accepts one value or a list of values.
Translates into <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> argument <code class="docutils literal notranslate"><span class="pre">--add-host=&lt;value&gt;</span></code>, allowing the user to add a custom DNS entry to the container.
If a list is provided, the option shall be expanded to multiple <code class="docutils literal notranslate"><span class="pre">--add-host</span></code> arguments, e.g. <code class="docutils literal notranslate"><span class="pre">--add-host=&lt;list-item-1&gt;</span> <span class="pre">--add-host=&lt;list-item-2&gt;</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">device</span></code></dt>
<dd>This options accepts one value or a list of values.
Translates into <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> argument <code class="docutils literal notranslate"><span class="pre">--device=&lt;value&gt;</span></code>, allowing the user to forward a device from the host machine to the container.
If a list is provided, the option shall be expanded to multiple <code class="docutils literal notranslate"><span class="pre">--device</span></code> arguments.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dns</span></code></dt>
<dd>Translates into <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> argument <code class="docutils literal notranslate"><span class="pre">--dns=&lt;value&gt;</span></code>, allowing the user to specify custom DNS servers to be used in the container.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">entrypoint</span></code></dt>
<dd>Translates into <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> argument <code class="docutils literal notranslate"><span class="pre">--entrypoint=&lt;value&gt;</span></code>, allowing the user to override the entrypoint as defined in the Docker image.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hostname</span></code></dt>
<dd>Translates into <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> argument <code class="docutils literal notranslate"><span class="pre">--hostname=&lt;value&gt;</span></code>, allowing the user to specify the hostname that the container shall use.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">init</span></code></dt>
<dd>This option only accepts boolean value <code class="docutils literal notranslate"><span class="pre">True</span></code>.
When provided, this translates into <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> argument <code class="docutils literal notranslate"><span class="pre">--init</span></code>, which adds an init daemon to the container.</dd>
</dl>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">image</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">buildpack-deps:testing</span><span class="w"></span>

<span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">docker-phase</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">variant-with-extra-docker-args</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">extra-docker-args</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">buildhost</span><span class="w"></span>
<span class="w">          </span><span class="nt">init</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class="w"></span>
<span class="w">          </span><span class="nt">device</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/ttyS0</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/kvm</span><span class="w"></span>
<span class="w">          </span><span class="nt">add-host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-test-host:10.1.2.3</span><span class="w"></span>
<span class="w">          </span><span class="nt">dns</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9.9.9.9</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;test &quot;$$HOSTNAME&quot; = &quot;buildhost&quot;&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="docker-in-docker">
<h2>Docker in Docker<a class="headerlink" href="#docker-in-docker" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-docker-in-docker">
<code class="descname">docker-in-docker</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-docker-in-docker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Sometimes it may be necessary to perform operations on the Docker daemon from within a Docker container.
E.g. trying to use some tool that resides in a different Docker container from within a build running in a container.
If that happens this option can be used to make the required Docker socket available within the first container.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">image</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">buildpack-deps:testing</span><span class="w"></span>

<span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">prepare</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">whoami</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">buildpack-deps:testing-curl</span><span class="w"></span>
<span class="w">        </span><span class="nt">docker-in-docker</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/bin/docker:/usr/bin/docker:ro</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker pull buildpack-deps:testing-curl</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="volumes">
<h2>Volumes<a class="headerlink" href="#volumes" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-volumes">
<code class="descname">volumes</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-volumes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>In order to execute commands within Docker it is often required to mount directories or a file to the docker container.
This can be done by specifying <a class="reference internal" href="#cmdoption-arg-volumes"><code class="xref std std-option docutils literal notranslate"><span class="pre">volumes</span></code></a>.
<a class="reference internal" href="#cmdoption-arg-volumes"><code class="xref std std-option docutils literal notranslate"><span class="pre">volumes</span></code></a> doesn’t have any effect when there is no <a class="reference internal" href="#cmdoption-arg-image"><code class="xref std std-option docutils literal notranslate"><span class="pre">image</span></code></a> specified.</p>
<p>There are two formats how a volume can be specified:</p>
<p><strong>Format 1</strong></p>
<p>The volume can be specified as <code class="docutils literal notranslate"><span class="pre">host-src</span></code>[:<code class="docutils literal notranslate"><span class="pre">container-dest</span></code>][:<code class="docutils literal notranslate"><span class="pre">&lt;options&gt;</span></code>].
The <code class="docutils literal notranslate"><span class="pre">options</span></code> are [rw|ro]
The <code class="docutils literal notranslate"><span class="pre">host-src</span></code> is an absolute path or a name value.</p>
<p><strong>Format 2</strong></p>
<dl class="docutils">
<dt>The volume can be specified using a dictionary with the following keys:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal notranslate"><span class="pre">source</span></code></li>
<li>[<code class="docutils literal notranslate"><span class="pre">target</span></code>]</li>
<li>[<code class="docutils literal notranslate"><span class="pre">read-only</span></code>]</li>
</ul>
</dd>
</dl>
<p>Where <code class="docutils literal notranslate"><span class="pre">source</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">host-src</span></code>, <code class="docutils literal notranslate"><span class="pre">target</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">container-dest</span></code> and <code class="docutils literal notranslate"><span class="pre">read-only</span></code> reflects the possible <code class="docutils literal notranslate"><span class="pre">options</span></code> with a boolean value.</p>
<p>By default the <code class="docutils literal notranslate"><span class="pre">host-src</span></code> is mounted rw.</p>
<p>When the given <code class="docutils literal notranslate"><span class="pre">host-src</span></code> doesn’t exist Hopic will create the path as a directory to prevent dockerd from creating the directory as root user.
If <code class="docutils literal notranslate"><span class="pre">container-dest</span></code> is not specified, it will take the same value as <code class="docutils literal notranslate"><span class="pre">host-src</span></code>.
For the <code class="docutils literal notranslate"><span class="pre">host-src</span></code> path, <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> or <code class="docutils literal notranslate"><span class="pre">~</span></code> will be expanded to the home directory of the current user.
While for the <code class="docutils literal notranslate"><span class="pre">container-dest</span></code>, <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> or <code class="docutils literal notranslate"><span class="pre">~</span></code> will be expanded to <code class="docutils literal notranslate"><span class="pre">/home/sandbox</span></code>.</p>
<p>The following directories and files are mounted by default:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="30%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">host-src</th>
<th class="head">container-dest</th>
<th class="head">&lt;options&gt;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">WORKSPACE</span></code> <a class="footnote-reference" href="#id2" id="id1">[*]</a></td>
<td>/code</td>
<td>read-write</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[*]</a></td><td><code class="docutils literal notranslate"><span class="pre">WORKSPACE/code</span></code> for repositories referring to other repositories for their code.</td></tr>
</tbody>
</table>
<p>These defaults can be disabled by specifying a <cite>null</cite> source for them:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"></span>
<span class="w">    </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/code</span><span class="w"></span>
</pre></div>
</div>
<p><a class="reference internal" href="#cmdoption-arg-volumes"><code class="xref std std-option docutils literal notranslate"><span class="pre">volumes</span></code></a> can be declared in every scope and will be used during the specified scopes
e.g. <a class="reference internal" href="#cmdoption-arg-volumes"><code class="xref std std-option docutils literal notranslate"><span class="pre">volumes</span></code></a> specified in global scope are used with every command.
In case an inherited bind mount needs to be overridden, that can be accomplished by adding a volume with the same <code class="docutils literal notranslate"><span class="pre">target_location</span></code>.
Consider the following example where <cite>/tmp/downloads</cite> is overridden:</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">buildpack-deps:testing-curl</span><span class="w"></span>

<span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~/</span><span class="w"></span>
<span class="w">    </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tools/devenv</span><span class="w"></span>
<span class="w">    </span><span class="nt">read-only</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/Music:/home/sandbox/temp</span><span class="w"></span>

<span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">list</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">jira</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">with-credentials</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">netrc</span><span class="w"></span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span><span class="w"></span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${SECRET_FILE}:~/.netrc:ro</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">curl -v --netrc --silent &quot;https://jira.atlassian.com/rest/api/2/search?maxResults=100&amp;fields=key,summary,assignee&amp;jql=resolution+%3D+unresolved+AND+%28project+%3D+BSERV+OR+assignee+%3D+currentUser()%29+ORDER+BY+priority+DESC%2C+created+ASC&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">print</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;only global volumes will be mounted&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">mounts</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">print</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;/tmp/Music will be overridden with /tmp/Downloads&quot;</span><span class="w"></span>
<span class="w">        </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/Downloads:/home/sandbox/temp</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">volumes</span><span class="p">:</span><span class="w"> </span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/Pictures:/home/sandbox/temp</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/Desktop</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;override /tmp/Downloads with /tmp/Pictures and /tmp/Desktop is added&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="environment-variables">
<h2>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-pass-through-environment-vars">
<code class="descname">pass-through-environment-vars</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-pass-through-environment-vars" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This option allows passing environment variables of the host environment through into containers.
This is a list of strings.
Each string is the name of an environment variable.
If the named environment variable exists in the host environment, it will be set to the same value inside the container.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-image:4.2.1</span><span class="w"></span>

<span class="nt">pass-through-environment-vars</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">JENKINS_TEST_INSTANCE</span><span class="w"></span>

<span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x86</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./build.sh</span><span class="w"></span>

<span class="w">  </span><span class="nt">upload</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x86</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./upload-from-non-test-only.sh</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="mounting-volumes-from-other-containers">
<h2>Mounting Volumes From Other Containers<a class="headerlink" href="#mounting-volumes-from-other-containers" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-volumes-from">
<code class="descname">volumes-from</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-volumes-from" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The option <code class="docutils literal notranslate"><span class="pre">volumes-from</span></code> allows you to mount volumes that are defined in an external <em>Docker image</em>.
The behavior translates directly to a <code class="docutils literal notranslate"><span class="pre">--volumes-from</span></code> Docker-run option; the volumes are mapped to the path as originally specified in the external image.</p>
<p>Note that this option does nothing if you haven’t specified a Docker image (see the <a class="reference internal" href="#cmdoption-arg-image"><code class="xref std std-option docutils literal notranslate"><span class="pre">image</span></code></a> option).</p>
<p>The option requires two keys to be specified:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">image-name</span></code></dt>
<dd>The full name of the Docker image.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">image-version</span></code></dt>
<dd>The targeted version of the Docker image.</dd>
</dl>
<p>The combination of <code class="docutils literal notranslate"><span class="pre">&lt;image-name&gt;:&lt;image-version&gt;</span></code> should result in a correct, downloadable Docker image.</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">coverity</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Coverity run</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">volumes-from</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hub.docker.com/tomtom/coverity</span><span class="w"></span>
<span class="w">          </span><span class="nt">image-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.4.7</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;cd build/x64-rel;</span><span class="w"></span>
<span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">/opt/coverity/bin/cov-configure --template --compiler c++ --comptype gcc --version 7.3 --config my_config.conf;</span><span class="w"></span>
<span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">/opt/coverity/bin/cov-build --config my_config.conf --dir cov-int ninja;</span><span class="w"></span>
<span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">echo etc.&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="publish-from-branch">
<h2>Publish From Branch<a class="headerlink" href="#publish-from-branch" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-publish-from-branch">
<code class="descname">publish-from-branch</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-publish-from-branch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">publish-from-branch</span></code> option, when provided, specifies a regular expression matching the names of branches from which to allow publication.
Publication includes version bumping (see <a class="reference internal" href="#id3"><code class="xref std std-option docutils literal notranslate"><span class="pre">version</span></code></a>) and the execution of any steps marked with <a class="reference internal" href="#cmdoption-arg-run-on-change"><code class="xref std std-option docutils literal notranslate"><span class="pre">run-on-change</span></code></a> as <code class="docutils literal notranslate"><span class="pre">only</span></code>.</p>
<p>If this option is omitted, Hopic allows publication from any branch.</p>
<p>The example below configures Hopic to only publish from the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch or any branch starting with <code class="docutils literal notranslate"><span class="pre">release/</span></code> or <code class="docutils literal notranslate"><span class="pre">rel-</span></code>.</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">publish-from-branch</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;^master$|^release/.*|^rel-.*&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="versioning">
<h2>Versioning<a class="headerlink" href="#versioning" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="id3">
<code class="descname">version</code><code class="descclassname"></code><a class="headerlink" href="#id3" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Hopic provides some support for determining and bumping of the currently checked out version.</p>
<p>It currently supports the syntax, sorting and bumping strategies of these versioning policies.
The policy to use can be specified in the <code class="docutils literal notranslate"><span class="pre">format</span></code> option of the <code class="docutils literal notranslate"><span class="pre">version</span></code> option section.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">semver</span></code></dt>
<dd><p class="first"><a class="reference external" href="https://semver.org/">Semantic Versioning</a>. This is the default when no policy is explicitly specified.</p>
<p>The default tag format is <code class="docutils literal notranslate"><span class="pre">{version.major}.{version.minor}.{version.patch}</span></code>.</p>
<p class="last">The default component to bump is the pre-release label.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">carver</span></code></dt>
<dd><p class="first">Caruso variation on Semantic Version for branching</p>
<p>The default tag format is <code class="docutils literal notranslate"><span class="pre">{version.major}{version.minor}{version.patch}+PI{version.increment}.{version.fix}</span></code>.</p>
<p class="last">The default component to bump is the pre-release label.</p>
</dd>
</dl>
<p>The version can be read from and stored in two locations:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">version.file</span></code></dt>
<dd>When this option is specified Hopic will always use this as the primary source for reading and storing the version.
The first line to contain only a syntactically valid version, optionally prefixed with <code class="docutils literal notranslate"><span class="pre">version=</span></code>, is assumed to be the version.
When reading the version it’ll use this verbatim.
When storing a (likely bumped) version it’ll only modify the version portion of that file.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">version.tag</span></code></dt>
<dd><p class="first">When this option is set to <code class="docutils literal notranslate"><span class="pre">true</span></code> or a non-empty string Hopic will, when storing, create a tag every time it creates a new version.
When this option is set to a string it will be interpreted according to <a class="reference external" href="https://docs.python.org/3/library/string.html#formatspec">Python Format Specification</a> with the named variable <code class="docutils literal notranslate"><span class="pre">version</span></code> containing the version.
When this option is set and <code class="docutils literal notranslate"><span class="pre">file</span></code> is not set it will use <a class="reference external" href="https://git-scm.com/docs/git-describe">git describe</a> to read the current version from tags.
When used for reading, it will mark commits that don’t have a tag a virtual prerelease of the predicted next version.</p>
<p class="last">Setting this option to a string can, for example, be used to add a prefix like <code class="docutils literal notranslate"><span class="pre">v</span></code> to tags, e.g. by using <code class="docutils literal notranslate"><span class="pre">v{version}</span></code>.
Having it set to <code class="docutils literal notranslate"><span class="pre">true</span></code> instead uses the version policy’s default formatting.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">version.build</span></code></dt>
<dd>When using <code class="docutils literal notranslate"><span class="pre">semver</span></code> it is possible to define custom <a class="reference external" href="https://semver.org/#spec-item-10">build metadata</a> (see <a class="reference external" href="https://semver.org/#spec-item-10">https://semver.org/#spec-item-10</a>), by setting the <code class="docutils literal notranslate"><span class="pre">build</span></code> property.
When this option is set, the <code class="docutils literal notranslate"><span class="pre">build</span></code> value will be appended to the tag according to the semver build metadata spec (<code class="docutils literal notranslate"><span class="pre">+&lt;version.build&gt;</span></code>).
Currently, this setting will only affect the PUBLISH_VERSION as described in the <a class="reference internal" href="#pre-defined-hopic-variables">Pre-defined Hopic variables</a> chapter.</dd>
</dl>
<p>When and what to bump can be controlled by the <code class="docutils literal notranslate"><span class="pre">version.bump</span></code> option.
When set to <code class="docutils literal notranslate"><span class="pre">false</span></code> it disables automated bumping completely.
Otherwise it describes a version bumping policy in its <code class="docutils literal notranslate"><span class="pre">version.bump.policy</span></code> member.</p>
<p>There are currently two version bumping policies available:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">constant</span></code></dt>
<dd><blockquote class="first">
<div>Its <code class="docutils literal notranslate"><span class="pre">version.bump.field</span></code> property specifies what field to bump.
It will always bump that field and no other.
When not specified it defaults to bumping the default-to-bump part of the used version policy.</div></blockquote>
<div class="last highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">semver</span><span class="w"></span>
<span class="w">  </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;v.{version.major}.{version.minor}.{version.patch}&#39;</span><span class="w"></span>
<span class="w">  </span><span class="nt">bump</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">constant</span><span class="w"></span>
<span class="w">    </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patch</span><span class="w"></span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">conventional-commits</span></code></dt>
<dd><p class="first">When used this policy determines the version field to bump based on commit messages formatted according to <a class="reference external" href="https://www.conventionalcommits.org/en/v1.0.0/">Conventional Commits</a>.
It searches all to-merge commits for breaking changes, new features and fixes.
If any of those are present it will bump, in order of precedence, the major, minor or patch number.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">version.bump.strict</span></code> option of this policy controls whether each commit message is required to parse as a valid Conventional Commit.
If set to <code class="docutils literal notranslate"><span class="pre">false</span></code> invalidly formatted messages are just ignored and not taken into account to determine what to bump.
Otherwise the merge will fail when encountering invalidly formatted messages.
Additionally, if <code class="docutils literal notranslate"><span class="pre">version.bump.strict</span></code> is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, the merge-change-request <code class="docutils literal notranslate"><span class="pre">title</span></code> version bump is validated against the corresponding commit messages version bump and the merge will fail if the version bump mismatches.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">version.bump.reject-breaking-changes-on</span></code> and <code class="docutils literal notranslate"><span class="pre">version.bump.reject-new-features-on</span></code> options specify regular expressions matching branch names.
Merges into these branches will be rejected if, respectively, they contain breaking changes or new features.
The purpose of this is to prevent accidental inclusion of these kinds of changes into release branches.</p>
<div class="last highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">semver</span><span class="w"></span>
<span class="w">  </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;v.{version.major}.{version.minor}.{version.patch}&#39;</span><span class="w"></span>
<span class="w">  </span><span class="nt">bump</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conventional-commits</span><span class="w"></span>
<span class="w">    </span><span class="nt">strict</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"> </span><span class="c1"># default</span><span class="w"></span>
<span class="w">    </span><span class="nt">reject-breaking-changes-on</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;release/.*|rel-.*&#39;</span><span class="w"> </span><span class="c1"># default</span><span class="w"></span>
<span class="w">    </span><span class="nt">reject-new-features-on</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;release/\d+\..*|rel-\d+\..*&#39;</span><span class="w"> </span><span class="c1"># default</span><span class="w"></span>
</pre></div>
</div>
</dd>
</dl>
<p>In order to configure a version bumping policy without automatically bumping for every change the <code class="docutils literal notranslate"><span class="pre">version.bump.on-every-change</span></code> option can be set to <code class="docutils literal notranslate"><span class="pre">false</span></code> (defaults to <code class="docutils literal notranslate"><span class="pre">true</span></code>).</p>
<p>When bumping is enabled, Hopic bumps each time that it applies a change.
Usually this means when it’s merging a pull request.
Another option is when it’s performing a modality change (currently only <code class="docutils literal notranslate"><span class="pre">UPDATE_DEPENDENCY_MANIFEST</span></code>).</p>
<dl class="docutils" id="hotfix-branch">
<dt><code class="docutils literal notranslate"><span class="pre">hotfix-branch</span></code></dt>
<dd><p class="first"><a class="reference internal" href="hotfix.html#hotfix"><span class="std std-ref">Hotfix</span></a> versioning is supported and performed on hotfix branches only.
If and only if a branch’s name matches the regular expression configured in this option will hotfix versioning be performed.
The regular expression in this option <em>MUST</em> either contain an <code class="docutils literal notranslate"><span class="pre">id</span></code> or <code class="docutils literal notranslate"><span class="pre">ID</span></code> named capture group or have exactly one capture group.
This capture group will be used as the <a class="reference internal" href="hotfix.html#hotfix-id"><span class="std std-ref">hotfix ID</span></a>.</p>
<p class="last">This defaults to matching branch names like <code class="docutils literal notranslate"><span class="pre">hotfix/x.y.z-{hotfix-id}</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hotfix-allowed-start-tags</span></code></dt>
<dd>This contains a list of commit tags to allow after the version tag that the <a class="reference internal" href="#hotfix-branch">hotfix-branch</a> has been split off from.
This will only get used when using the <a class="reference external" href="https://www.conventionalcommits.org/en/v1.0.0/">Conventional Commits</a> bumping policy.
This defaults to an empty set.</dd>
</dl>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">Describe <code class="docutils literal notranslate"><span class="pre">after-submit</span></code>. Maybe?</p>
</div>
</div>
<div class="section" id="modality-changes">
<h2>Modality Changes<a class="headerlink" href="#modality-changes" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-modality-source-preparation">
<code class="descname">modality-source-preparation</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-modality-source-preparation" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">modality-source-preparation</span></code> option allows for influencing the build according to the <code class="docutils literal notranslate"><span class="pre">MODALITY</span></code> parameter.
If Hopic is called with a <code class="docutils literal notranslate"><span class="pre">MODALITY</span></code> that is present in the configuration file, then the commands as specified in that section are executed before the other phases.</p>
<p>See the description of the <code class="docutils literal notranslate"><span class="pre">apply-modality-change</span></code> parameter on the <cite>Usage</cite> page for the calling syntax.</p>
<p>Note that this is, above all, a remnant of the previous generation pipeline; it is currently only used to perform <code class="docutils literal notranslate"><span class="pre">UPDATE_DEPENDENCY_MANIFEST</span></code> builds.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Defining new functionality using this option is discouraged.</p>
</div>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">description</span></code></dt>
<dd>An optional description for the command, which will be printed in the logs.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sh</span></code></dt>
<dd>The actual command to be run. Variables will be expanded, similar to commands defined in the <a class="reference internal" href="#cmdoption-arg-phases"><code class="xref std std-option docutils literal notranslate"><span class="pre">phases</span></code></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">changed-files</span></code></dt>
<dd><p class="first">Specifies the files that are changed by the command, which are to be added to the commit.</p>
<p class="last">If omitted, Hopic forces a clean repository before running the command specified by <code class="docutils literal notranslate"><span class="pre">sh</span></code>.
Upon completion of the command, all files that are changed, removed and/or previously untracked are added to the commit.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">commit-message</span></code></dt>
<dd><p class="first">The message that will be used to commit the changes when this modality is run.</p>
<p>This option is mutually exclusive with <code class="docutils literal notranslate"><span class="pre">commit-message-cmd</span></code>.</p>
<p class="last">If omitted, the value of the <code class="docutils literal notranslate"><span class="pre">MODALITY</span></code> parameter is used as the commit message.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">commit-message-cmd</span></code></dt>
<dd><p class="first">A command, or a mapping with an <code class="xref std std-option docutils literal notranslate"><span class="pre">sh</span></code> option, of which <code class="docutils literal notranslate"><span class="pre">stdout</span></code> is used as the commit message of this modality.</p>
<p>This option is mutually exclusive with <code class="docutils literal notranslate"><span class="pre">commit-message</span></code>.</p>
<p class="last">If omitted, the value of the <code class="docutils literal notranslate"><span class="pre">MODALITY</span></code> parameter is used as the commit message.</p>
</dd>
</dl>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">modality-source-preparation</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">UPDATE_DEPENDENCY_MANIFEST</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">update_dependency_manifest.py ${CFGDIR}/dependency_manifest.xml ${CFGDIR}/ivysettings.xml</span><span class="w"></span>
<span class="w">      </span><span class="nt">changed-files</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${CFGDIR}/dependency_manifest.xml</span><span class="w"></span>
<span class="w">      </span><span class="nt">commit-message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update of dependency manifest</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="extension-installation">
<h2>Extension Installation<a class="headerlink" href="#extension-installation" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-pip">
<code class="descname">pip</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-pip" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Hopic can be extended with extra Python packages.
For this purpose it provides the ability to install packages, with pip, before building.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pip</span></code> option contains a list of requirement strings or package installation specifications.
Each of those specifications may contain these options:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">packages</span></code></dt>
<dd><p class="first">This option is mandatory.</p>
<p class="last">It contains a list of pip requirement strings.
E.g. <code class="docutils literal notranslate"><span class="pre">click&gt;=7,&lt;8</span></code> or <code class="docutils literal notranslate"><span class="pre">python-keyring</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">from-index</span></code></dt>
<dd><p class="first">This must be a single URL string.</p>
<p class="last">When specified this causes pip to install from this package index instead of the default one.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">with-extra-index</span></code></dt>
<dd><p class="first">This must be a single URL string or a list of URL strings.</p>
<p class="last">When specified this causes pip to look in this index when the primary one doesn’t contain the specified packages.</p>
</dd>
</dl>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pip</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">with-extra-index</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://test.pypi.org/simple/</span><span class="w"></span>
<span class="w">    </span><span class="nt">packages</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">commisery&gt;=0.2,&lt;1</span><span class="w"></span>

<span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">style</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">commit-messages</span><span class="p">:</span><span class="w"> </span><span class="kt">!template</span><span class="w"> </span><span class="s">&quot;commisery&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="restricting-variants-to-specific-build-nodes">
<h2>Restricting Variants to Specific Build Nodes<a class="headerlink" href="#restricting-variants-to-specific-build-nodes" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-node-label">
<code class="descname">node-label</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-node-label" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The option <code class="docutils literal notranslate"><span class="pre">node-label</span></code> executes the specified steps on an agent available in the Jenkins environment with the provided label(s).</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Linux-x86_64-Release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">node-label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Linux &amp;&amp; Docker &amp;&amp; Release</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build/build.py -f Build/Linux-x86_64.yaml -m Release</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="restricting-steps-to-changes-or-not">
<h2>Restricting Steps to Changes or Not<a class="headerlink" href="#restricting-steps-to-changes-or-not" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-run-on-change">
<code class="descname">run-on-change</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-run-on-change" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="hopic.config_reader.RunOnChange">
<em class="property">class </em><code class="descclassname">hopic.config_reader.</code><code class="descname">RunOnChange</code><a class="headerlink" href="#hopic.config_reader.RunOnChange" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#cmdoption-arg-run-on-change"><code class="xref std std-option docutils literal notranslate"><span class="pre">run-on-change</span></code></a> option allows you to specify when a step needs to be executed.
The value of this option can be one of:</p>
<dl class="attribute">
<dt id="hopic.config_reader.RunOnChange.always">
<code class="descname">always</code><em class="property"> = 'always'</em><a class="headerlink" href="#hopic.config_reader.RunOnChange.always" title="Permalink to this definition">¶</a></dt>
<dd><p>The steps will always be performed. (Default if not specified).</p>
</dd></dl>

<dl class="attribute">
<dt id="hopic.config_reader.RunOnChange.never">
<code class="descname">never</code><em class="property"> = 'never'</em><a class="headerlink" href="#hopic.config_reader.RunOnChange.never" title="Permalink to this definition">¶</a></dt>
<dd><p>The steps will never be performed for a change.</p>
</dd></dl>

<dl class="attribute">
<dt id="hopic.config_reader.RunOnChange.new_version_only">
<code class="descname">new_version_only</code><em class="property"> = 'new-version-only'</em><a class="headerlink" href="#hopic.config_reader.RunOnChange.new_version_only" title="Permalink to this definition">¶</a></dt>
<dd><p>The steps will only be performed when the change is on a new version and is to be submitted in the current execution.</p>
</dd></dl>

<dl class="attribute">
<dt id="hopic.config_reader.RunOnChange.only">
<code class="descname">only</code><em class="property"> = 'only'</em><a class="headerlink" href="#hopic.config_reader.RunOnChange.only" title="Permalink to this definition">¶</a></dt>
<dd><p>The steps will only be performed when the change is to be submitted in the current execution.</p>
</dd></dl>

</dd></dl>

<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-release</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-debug</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-debug</span><span class="w"></span>

<span class="w">  </span><span class="nt">upload</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">only</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x64-release/do-upload.sh</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-debug</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">only</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x64-debug/do-upload.sh</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="limiting-execution-time-for-steps">
<h2>Limiting Execution Time for Steps<a class="headerlink" href="#limiting-execution-time-for-steps" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-timeout">
<code class="descname">timeout</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-timeout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The option <code class="docutils literal notranslate"><span class="pre">timeout</span></code> allows specifying an upper limit to how long a step is allowed to execute.
When this time gets exceeded the process will get aborted and the build will stop with an error.</p>
<p>When this option is specified combined with a command the timeout applies to that command’s execution only.
Otherwise this option has to be specified separately <em>and</em> before any command, in which case it applies to every command in that variant.</p>
<p>The current implementation only accepts timeouts expressed as positive real numbers interpreted as seconds.
In the future other units may be added as a suffix.
Without an explicit unit present or some other notation the interpretation will always be as seconds.</p>
<p><strong>example timeout combined with command:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">180</span><span class="w"></span>
<span class="w">        </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-release</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-debug</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span><span class="w"></span>
<span class="w">        </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-debug</span><span class="w"></span>

<span class="w">  </span><span class="nt">upload</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">only</span><span class="w"></span>
<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30.5</span><span class="w"></span>
<span class="w">        </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x64-release/do-upload.sh</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-debug</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">only</span><span class="w"></span>
<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">45.75</span><span class="w"></span>
<span class="w">        </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x64-debug/do-upload.sh</span><span class="w"></span>
</pre></div>
</div>
<p><strong>example timeout per variant:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">180</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span><span class="w"></span>
<span class="w">        </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./configure</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">make</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">make test</span><span class="w"></span>

<span class="nt">post-submit</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">upload</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">make upload</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="sharing-output-data-between-variants">
<h2>Sharing Output Data Between Variants<a class="headerlink" href="#sharing-output-data-between-variants" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-stash">
<code class="descname">stash</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-stash" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The option <code class="docutils literal notranslate"><span class="pre">stash</span></code> will save files to be used in another Hopic phase.
The stashed files are available for every executor/node in every phase and workspace after the current one.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This option is not allowed to be used within a <a class="reference internal" href="#cmdoption-arg-post-submit"><code class="xref std std-option docutils literal notranslate"><span class="pre">post-submit</span></code></a> phase.</p>
</div>
<p>Use the option <code class="docutils literal notranslate"><span class="pre">includes</span></code> to identify the files to be stashed.
Use Wildcards like <cite>module/dist/**/*.zip</cite>.
A <cite>*</cite> expands only to a single directory entry, where <cite>**</cite> expands to multiple directory levels deep.</p>
<p>Use the option <code class="docutils literal notranslate"><span class="pre">dir</span></code> to change the working directory that is being used while stashing.</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">builld</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">stash</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">stash</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">includes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stash/stash.txt</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mkdir -p stash</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo stashed_file &gt; stash/stash.txt&#39;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ls -l</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ls -l stash</span><span class="w"></span>

<span class="w">    </span><span class="nt">stash-dir</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">stash</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">includes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stashed_dir.txt</span><span class="w"></span>
<span class="w">        </span><span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stash/stashed_dir</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mkdir -p stash/stashed_dir</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo stashed_dir &gt; stash/stashed_dir/stashed_dir.txt&#39;</span><span class="w"> </span>

<span class="w">  </span><span class="nt">upload</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">stash</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ls -l $WORKSPACE/stash</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ls -l $WORKSPACE/stashed_dir</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="customizing-step-description">
<h2>Customizing Step Description<a class="headerlink" href="#customizing-step-description" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-description">
<code class="descname">description</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-description" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The option <code class="docutils literal notranslate"><span class="pre">description</span></code> adds a description to the step which will be printed in the logs.</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">quality</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Coverity</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Coverity run</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">volumes-from</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hub.docker.com/tomtom/coverity</span><span class="w"></span>
<span class="w">          </span><span class="nt">image-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.4.6</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo -e &quot;Run Coverity here, eg.:\n  cov-configure --template --compiler gcc --comptype gcc\n  cov-configure -co /tools/devenv/Linux/Linux/gcc-4.8.2/bin/c++ -- -msse -mfpmath=sse\netc..&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="branches-in-subdirectory-worktrees">
<h2>Branches in Subdirectory Worktrees<a class="headerlink" href="#branches-in-subdirectory-worktrees" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-worktrees">
<code class="descname">worktrees</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-worktrees" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This option is not allowed to be used within a <a class="reference internal" href="#cmdoption-arg-post-submit"><code class="xref std std-option docutils literal notranslate"><span class="pre">post-submit</span></code></a> phase.</p>
</div>
<div class="admonition-todo admonition" id="index-2">
<p class="first admonition-title">Todo</p>
<p class="last">Document <a class="reference internal" href="#cmdoption-arg-worktrees"><code class="xref std std-option docutils literal notranslate"><span class="pre">worktrees</span></code></a> option.</p>
</div>
</div>
<div class="section" id="repeating-steps-for-commits">
<h2>Repeating Steps for Commits<a class="headerlink" href="#repeating-steps-for-commits" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-foreach">
<code class="descname">foreach</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-foreach" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="admonition-todo admonition" id="index-3">
<p class="first admonition-title">Todo</p>
<p class="last">Document <a class="reference internal" href="#cmdoption-arg-foreach"><code class="xref std std-option docutils literal notranslate"><span class="pre">foreach</span></code></a> option.</p>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SOURCE_COMMIT</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SOURCE_COMMITS</span></code></li>
</ul>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">AUTOSQUASHED_COMMIT</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">AUTOSQUASHED_COMMITS</span></code></li>
</ul>
</div>
<div class="section" id="sub-scm">
<h2>Sub SCM<a class="headerlink" href="#sub-scm" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-scm">
<code class="descname">scm</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-scm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="admonition-todo admonition" id="index-4">
<p class="first admonition-title">Todo</p>
<p class="last">Document <a class="reference internal" href="#cmdoption-arg-scm"><code class="xref std std-option docutils literal notranslate"><span class="pre">scm</span></code></a> option.</p>
</div>
</div>
<div class="section" id="junit-test-results">
<h2>JUnit Test Results<a class="headerlink" href="#junit-test-results" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-junit">
<code class="descname">junit</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-junit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The option <code class="docutils literal notranslate"><span class="pre">junit</span></code> triggers Jenkins Unit Testing.
For more information about this feature see: <a class="reference external" href="https://www.tutorialspoint.com/jenkins/jenkins_unit_testing.htm">https://www.tutorialspoint.com/jenkins/jenkins_unit_testing.htm</a></p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-release</span><span class="w"></span>

<span class="w">  </span><span class="nt">test</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-debug</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">junit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x64-debug/test-unit.xml</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-debug --target test</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="junit-allow-missing">
<h2>JUnit allow-missing<a class="headerlink" href="#junit-allow-missing" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-allow-missing">
<code class="descname">allow-missing</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-allow-missing" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Normally, a build fails if none of the specified JUnit XML files are found.
Setting this option’s value to true allows the build to continue even if no JUnit XML files were found.
When this option is specified, JUnit configuration must contain also a <code class="docutils literal notranslate"><span class="pre">test-results</span></code> option which specifies
which XML files to be uploaded.</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">example</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">junit</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">test-results</span><span class="p">:</span><span class="w"> </span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">doesnotexistjunitresult.xml</span><span class="w"></span>
<span class="w">          </span><span class="nt">allow-missing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="junit-allow-failures">
<h2>JUnit allow-failures<a class="headerlink" href="#junit-allow-failures" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-allow-failures">
<code class="descname">allow-failures</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-allow-failures" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Normally, a build fails if junit XML report file contains failed tests.
Setting this option’s value to true allows the build to continue even if junit XML report file contains
failed tests. The variant will still be marked as “failed”, but the pipeline will continue.</p>
<p><strong>Note</strong>: This option cannot suppress failures in test execution. If an executable that produces the junit
report fails, the pipeline will still fail. This option is useful when junit represents static analysis
report: a tool succeeds, but produces a report which can be uploaded.</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">example</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">junit</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">test-results</span><span class="p">:</span><span class="w"> </span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">doesnotexistjunitresult.xml</span><span class="w"></span>
<span class="w">          </span><span class="nt">allow-failures</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="artifact-archiving">
<h2>Artifact Archiving<a class="headerlink" href="#artifact-archiving" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-archive">
<code class="descname">archive</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-archive" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The option <code class="docutils literal notranslate"><span class="pre">archive</span></code> allows you to archive build artifacts.
The artifacts can be stored on Jenkins and/or archived to Artifactory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This option is not allowed to be used within a <a class="reference internal" href="#cmdoption-arg-post-submit"><code class="xref std std-option docutils literal notranslate"><span class="pre">post-submit</span></code></a> phase.</p>
</div>
<p>The base directory is the workspace.
Artifacts specified are discovered relative to the workspace.</p>
<p>Use Wildcards like <cite>module/dist/**/*.zip</cite>.
A <cite>*</cite> expands only to a single directory entry, where <cite>**</cite> expands to multiple directory levels deep.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">pattern</span></code> option to identify and upload a specific artifact.
The specific artifact can then be uploaded to artifactory with the option <code class="docutils literal notranslate"><span class="pre">target</span></code>.</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake -B build-x64-release -S . -DCMAKE_BUILD_TYPE=RelWithDebInfo</span><span class="w"></span>

<span class="w">  </span><span class="nt">upload</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-release --target package</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">archive</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build/Output/x64/release/**</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build/Output/x64/release/TomTom-Package-${VERSION}-x64.tar.gz</span><span class="w"></span>
<span class="w">              </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cs-snapshot/com.tomtom.package/Package/x64/release/${VERSION}/TomTom-Package-x64-release-${VERSION}.tar.gz</span><span class="w"></span>
<span class="w">        </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">only</span><span class="w"></span>
</pre></div>
</div>
<dl class="option">
<dt id="cmdoption-arg-upload-artifactory">
<code class="descname">upload-artifactory</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-upload-artifactory" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The option <code class="docutils literal notranslate"><span class="pre">upload-artifactory</span></code> allows you to archive build artifacts to Artifactory.
The option <code class="docutils literal notranslate"><span class="pre">id</span></code> is the named identifier referring to a preconfigured Artifactory server from Jenkins’ global configuration.
The artifacts to be uploaded are specified with the <code class="docutils literal notranslate"><span class="pre">artifacts</span></code> option.</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">upload</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Linux-x86_64</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">archive</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x86/TomTom-Stacktrace-${VERSION}-Linux-x86_64.tar.gz</span><span class="w"></span>
<span class="w">              </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cs-psa-p1cms-snapshot/com.tomtom.stacktrace/Stacktrace/linux/x86_64/release/${VERSION}/Stacktrace-linux-x86_64-release-custom-${VERSION}.tar.gz</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x86/TomTom-Stacktrace-${VERSION}-Linux-x86_64.tar.gz</span><span class="w"></span>
<span class="w">              </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cs-psa-p1cms-snapshot/com.tomtom.stacktrace/Stacktrace/linux/x86_64/debug/${VERSION}/Stacktrace-linux-x86_64-release-custom-${VERSION}.tar.gz</span><span class="w"></span>
<span class="w">          </span><span class="nt">upload-artifactory</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">artifactory-navkit</span><span class="w"></span>
<span class="w">        </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">only</span><span class="w"></span>
</pre></div>
</div>
<dl class="option">
<dt id="cmdoption-arg-artifactory">
<code class="descname">artifactory</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-artifactory" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The option <code class="docutils literal notranslate"><span class="pre">artifactory</span></code> lets the user create promotion definitions for specific Artifactory repositories.
The option <code class="docutils literal notranslate"><span class="pre">promotion</span></code> is used to promote build artifacts. After this option the Artifactory server ID is specified.
The option <code class="docutils literal notranslate"><span class="pre">target-repo</span></code> specifies the Artifactory target repository.</p>
<p>Only build artifacts that were uploaded with the option <code class="docutils literal notranslate"><span class="pre">upload-artifactory</span></code> will be promoted.</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artifactory</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">promotion</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">artifactory-navkit</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">target-repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cs-psa-p1cms-release</span><span class="w"></span>

<span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Linux-x86_64</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x86</span><span class="w"></span>
<span class="w">    </span><span class="nt">Linux_AGL-aarch64</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-agl-aarch64</span><span class="w"></span>

<span class="w">  </span><span class="nt">package</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Linux-x86_64</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">fingerprint</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x86/TomTom-Stacktrace-${VERSION}-Linux-x86_64.tar.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x86 --target package</span><span class="w"></span>

<span class="w">  </span><span class="nt">upload</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">Linux-x86_64</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">archive</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x86/TomTom-Stacktrace-${VERSION}-Linux-x86_64.tar.gz</span><span class="w"></span>
<span class="w">              </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cs-psa-p1cms-snapshot/com.tomtom.stacktrace/Stacktrace/linux/x86_64/release/${VERSION}/Stacktrace-linux-x86_64-release-custom-${VERSION}.tar.gz</span><span class="w"></span>
<span class="w">          </span><span class="nt">upload-artifactory</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">artifactory-navkit</span><span class="w"></span>
<span class="w">        </span><span class="nt">run-on-change</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">only</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="artifact-fingerprint">
<h2>Artifact Fingerprint<a class="headerlink" href="#artifact-fingerprint" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-fingerprint">
<code class="descname">fingerprint</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-fingerprint" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The option <code class="docutils literal notranslate"><span class="pre">fingerprint</span></code> triggers fingerprinting of build artifacts on Jenkins.
Use the option <code class="docutils literal notranslate"><span class="pre">artifacts</span></code> to identify the artifacts to be fingerprinted.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This option is not allowed to be used within a <a class="reference internal" href="#cmdoption-arg-post-submit"><code class="xref std std-option docutils literal notranslate"><span class="pre">post-submit</span></code></a> phase.</p>
</div>
<p>With the <code class="docutils literal notranslate"><span class="pre">fingerprint</span></code> option, the Jenkins “fingerprint” feature is invoked.
For more information about this feature see: <a class="reference external" href="https://jenkins.io/doc/pipeline/steps/core/#fingerprint-record-fingerprints-of-files-to-track-usage">https://jenkins.io/doc/pipeline/steps/core/#fingerprint-record-fingerprints-of-files-to-track-usage</a></p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-release</span><span class="w"></span>

<span class="w">  </span><span class="nt">package</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x64-release</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">fingerprint</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build-x64-release/TomTom-Stacktrace-${VERSION}-Linux-x86_64.tar.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cmake --build build-x64-release --target package</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="artifact-upload-on-fail">
<h2>Artifact upload-on-fail<a class="headerlink" href="#artifact-upload-on-fail" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-upload-on-failure">
<code class="descname">upload-on-failure</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-upload-on-failure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The option <code class="docutils literal notranslate"><span class="pre">upload-on-failure</span></code> allows artifacts to be uploaded regardless of the build status.
By default option is disabled (set to <code class="docutils literal notranslate"><span class="pre">false</span></code>), which means that artifacts are not published when build is not marked as success.
Set this value to <code class="docutils literal notranslate"><span class="pre">true</span></code> to enable this option.</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">bump</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>

<span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">example</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">archive</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">produce_output.txt</span><span class="w"></span>
<span class="w">          </span><span class="nt">upload-on-failure</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">touch produce_output.txt</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="artifact-allow-empty-archive">
<h2>Artifact allow-empty-archive<a class="headerlink" href="#artifact-allow-empty-archive" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">allow-empty-archive</span></code> is a deprecated name for the <code class="docutils literal notranslate"><span class="pre">allow-missing</span></code> option.</p>
</div>
<p>Avoid its use as it will be removed in the next release.
Enabling both <code class="docutils literal notranslate"><span class="pre">allow-empty-archive</span></code> and  <code class="docutils literal notranslate"><span class="pre">allow-missing</span></code> will result in a configuration error.</p>
</div>
<div class="section" id="artifact-allow-missing">
<h2>Artifact allow-missing<a class="headerlink" href="#artifact-allow-missing" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="id4">
<code class="descname">allow-missing</code><code class="descclassname"></code><a class="headerlink" href="#id4" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Normally, a build fails if archiving returns zero artifacts. This option allows the archiving process to return
nothing without failing the build. Instead, the archive step will simply throw a warning.
Set this value to <code class="docutils literal notranslate"><span class="pre">true</span></code> to enable this option.</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">example</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">archive</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">doesnotexist.txt</span><span class="w"></span>
<span class="w">          </span><span class="nt">allow-missing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="embed-scripts">
<h2>Embed scripts<a class="headerlink" href="#embed-scripts" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-embed">
<code class="descname">!embed</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-embed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The option <code class="docutils literal notranslate"><span class="pre">!embed</span></code> allows Hopic to embed a part of the configuration file from an external source.
This can be via a command line script (sed, cat, etc), or by evaluating a script.
The <code class="docutils literal notranslate"><span class="pre">!embed</span></code> option requires to have a <code class="docutils literal notranslate"><span class="pre">cmd</span></code> argument which is the command to execute.
The command should output the part of the configuration file to standard output.</p>
<p>The location of a script should be specified either from the workspace directory or the configuration file directory.</p>
<p><strong>example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="nt">x86_64</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;building...&quot;</span><span class="w"></span>

<span class="w">  </span><span class="nt">generate</span><span class="p">:</span><span class="w"> </span><span class="kt">!embed</span><span class="w"></span>
<span class="w">    </span><span class="nt">cmd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yaml-generation.py variant</span><span class="w"></span>
</pre></div>
</div>
<p>With yaml-generation.py:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dedent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    test-</span><span class="si">{</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span>
<span class="s2">      - echo generated test variant</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="section" id="finally">
<h2>Finally<a class="headerlink" href="#finally" title="Permalink to this headline">¶</a></h2>
<dl class="option">
<dt id="cmdoption-arg-finally">
<code class="descname">finally</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-arg-finally" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The option <code class="docutils literal notranslate"><span class="pre">finally</span></code> can be used within a variant to specify actions that should be executed regardless of an earlier failure.
Intended actions for <code class="docutils literal notranslate"><span class="pre">finally</span></code> could be metrics reporting or resource cleanup actions.</p>
<p>Finally is syntactically the same as a variant, however the following keywords are forbidden:</p>
<ul class="simple">
<li><a class="reference internal" href="#cmdoption-arg-finally"><code class="xref std std-option docutils literal notranslate"><span class="pre">finally</span></code></a></li>
<li><a class="reference internal" href="#cmdoption-arg-fingerprint"><code class="xref std std-option docutils literal notranslate"><span class="pre">fingerprint</span></code></a></li>
<li><a class="reference internal" href="#cmdoption-arg-foreach"><code class="xref std std-option docutils literal notranslate"><span class="pre">foreach</span></code></a></li>
<li><a class="reference internal" href="#cmdoption-arg-junit"><code class="xref std std-option docutils literal notranslate"><span class="pre">junit</span></code></a></li>
<li><a class="reference internal" href="#cmdoption-arg-node-label"><code class="xref std std-option docutils literal notranslate"><span class="pre">node-label</span></code></a></li>
<li><a class="reference internal" href="#cmdoption-arg-run-on-change"><code class="xref std std-option docutils literal notranslate"><span class="pre">run-on-change</span></code></a></li>
<li><a class="reference internal" href="#cmdoption-arg-stash"><code class="xref std std-option docutils literal notranslate"><span class="pre">stash</span></code></a></li>
<li><code class="xref std std-option docutils literal notranslate"><span class="pre">wait-on-full-previous-phase</span></code></li>
<li><a class="reference internal" href="#cmdoption-arg-worktrees"><code class="xref std std-option docutils literal notranslate"><span class="pre">worktrees</span></code></a></li>
</ul>
<p>When there is no <code class="docutils literal notranslate"><span class="pre">sh</span></code> block next to the <code class="docutils literal notranslate"><span class="pre">finally</span></code> block, the <code class="docutils literal notranslate"><span class="pre">finally</span></code> block is considered global for the variant.
It is <em>not</em> allowed to specify a <code class="docutils literal notranslate"><span class="pre">sh</span></code> command after the global <code class="docutils literal notranslate"><span class="pre">finally</span></code> is defined.
The global <code class="docutils literal notranslate"><span class="pre">finally</span></code> is always executed last within the variant.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">finally</span></code> is specified on the same level as an <code class="docutils literal notranslate"><span class="pre">sh</span></code> command, the <code class="docutils literal notranslate"><span class="pre">finally</span></code> block is only executed when the
corresponding <code class="docutils literal notranslate"><span class="pre">sh</span></code> block was executed, but not if an early command failed.</p>
<p><a class="reference internal" href="#cmdoption-arg-timeout"><code class="xref std std-option docutils literal notranslate"><span class="pre">timeout</span></code></a> is supported, but only when attached to a command.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">phases</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">a</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">x</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;hello world&quot;</span><span class="w"></span>
<span class="w">        </span><span class="nt">finally</span><span class="p">:</span><span class="w"> </span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;hello world finally&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">invalid_cmd</span><span class="w"></span>
<span class="w">        </span><span class="nt">finally</span><span class="p">:</span><span class="w"> </span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;invalid cmd finally&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;never reach this point&quot;</span><span class="w"></span>
<span class="w">        </span><span class="nt">finally</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;never execute finally&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">finally</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;last finally&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3>Versions</h3>
<ul>
    <li><a href="master/config.html">master</a></li>
    <li><a href="release_0/config.html">release/0</a></li>
    <li><a href="release_1/config.html">release/1</a></li>
</ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="hotfix.html" title="Hotfix Version Requirements"
             >next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Hopic 1.59.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022 - 2020, TomTom N.V..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.6.
    </div>
  </body>
</html>