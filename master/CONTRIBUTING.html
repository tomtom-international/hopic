
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Contributing &#8212; Hopic 1.25.1.dev38+g4f9c649 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/banner.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Changelog" href="changes.html" />
    <link rel="prev" title="Configuration" href="config.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="changes.html" title="Changelog"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="config.html" title="Configuration"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Hopic 1.25.1.dev38+g4f9c649 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="contributing">
<h1>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h1>
<p>First off, thank you for taking the time to contribute!
The following information should help you make this process as smooth as possible.</p>
<div class="section" id="design-philosophy">
<h2>Design philosophy<a class="headerlink" href="#design-philosophy" title="Permalink to this headline">¶</a></h2>
<p>Before making a contribution to this repository, it’s good to know the philosophy upon which Hopic was written.</p>
<div class="section" id="the-importance-of-local-development">
<h3>1. The importance of local development<a class="headerlink" href="#the-importance-of-local-development" title="Permalink to this headline">¶</a></h3>
<p>Hopic was conceived mainly due to the previous CI system and its syntax being terribly undescriptive and difficult to debug.
This led to one of Hopic’s main requirements: a <strong>local developer should be able to perform the same build steps as the CI system</strong>.
The user needs to know whether his changes will build <em>before</em> submitting it.</p>
<p>Aside from that, <em>when</em> the CI system runs into an issue. The logs must contain useful information that can be used to replicate the issue locally, making debugging the issue less painful.</p>
</div>
<div class="section" id="clear-and-readable-configuration-format">
<h3>2. Clear and readable configuration format<a class="headerlink" href="#clear-and-readable-configuration-format" title="Permalink to this headline">¶</a></h3>
<p>We want to keep Hopic’s configuration format as dumb as we can get away with, but not any dumber than that.
When a human examines a Hopic file, the build steps that Hopic performs should be clear, unambiguous and unaffected by external factors.</p>
<p>Therefore, <strong>keeping complexity low</strong> is always a key consideration in changes to Hopic’s configuration format. Well, that, and <strong>maintaining backwards compatibility</strong>, of course.</p>
</div>
<div class="section" id="testability">
<h3>3. Testability<a class="headerlink" href="#testability" title="Permalink to this headline">¶</a></h3>
<p>Hopic is intended to be used by CI systems by way of a branch reference (that is, they directly install <code class="docutils literal notranslate"><span class="pre">release/N</span></code>).
Active development happens on the release branch directly (except for breaking changes, which are staged in <code class="docutils literal notranslate"><span class="pre">master</span></code>). This means that any changes that are merged to those branches are picked up immediately by dozens of users.
Therefore, <strong>testing is vitally important</strong> in Hopic; any new feature or bug-fix should be covered by one or more tests.</p>
</div>
</div>
<div class="section" id="setting-up-your-environment">
<h2>Setting up your environment<a class="headerlink" href="#setting-up-your-environment" title="Permalink to this headline">¶</a></h2>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>In order to start development on Hopic, you’ll want to make sure the following packages are installed:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">python3-pip</span></code>, <code class="docutils literal notranslate"><span class="pre">python3-setuptools</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span></code> for core functionality</li>
<li><code class="docutils literal notranslate"><span class="pre">docker.io</span></code> for executing Hopic’s own build</li>
<li><code class="docutils literal notranslate"><span class="pre">tox</span></code> for local testing</li>
</ul>
<p>If they aren’t, install them through your platform’s package manager, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span> <span class="n">install</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">install</span><span class="o">-</span><span class="n">recommends</span> <span class="n">python3</span><span class="o">-</span><span class="n">pip</span> <span class="n">python3</span><span class="o">-</span><span class="n">setuptools</span> <span class="n">git</span> <span class="n">docker</span><span class="o">.</span><span class="n">io</span>
<span class="n">pip3</span> <span class="n">install</span> <span class="n">tox</span>
</pre></div>
</div>
</div>
<div class="section" id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>For development, we recommend installing Hopic as an editable package, through either <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip3</span> <span class="n">install</span> <span class="o">--</span><span class="n">user</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
<p>or <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">develop</span>
</pre></div>
</div>
<p>This will install Hopic’s dependencies and configure the <code class="docutils literal notranslate"><span class="pre">hopic</span></code> Python 3 package to use a “live” version; any changes you make to the code will be immediately reflected in your environment’s <code class="docutils literal notranslate"><span class="pre">hopic</span></code> executable.</p>
</div>
</div>
<div class="section" id="making-changes">
<h2>Making changes<a class="headerlink" href="#making-changes" title="Permalink to this headline">¶</a></h2>
<p>Hopic consists of two parts:</p>
<ul class="simple">
<li>a Python module, containing the CLI, merging and execution logic, etc.</li>
<li>a Groovy file, which contains some glue code to specific CI system components (Jenkins and Bitbucket)</li>
</ul>
<p>As mentioned before, avoid any additions to the Groovy file as much as possible. Instead, create generic, CI-system-independent solutions.</p>
<div class="section" id="python">
<h3>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<p>The Python code can be found in <code class="docutils literal notranslate"><span class="pre">/hopic</span></code>.
The test set lives in <code class="docutils literal notranslate"><span class="pre">/hopic/test</span></code>.</p>
<p>The <a class="reference external" href="https://docs.pytest.org/en/stable/index.html">PyTest framework</a> is used as a testing framework; API reference can be found <a class="reference external" href="https://docs.pytest.org/en/stable/reference.html">here</a>.
The <a class="reference external" href="https://click.palletsprojects.com/en/7.x/">Click library</a> is used for command line handling; API reference can be found <a class="reference external" href="https://click.palletsprojects.com/en/7.x/#api-reference">here</a>.
The <a class="reference external" href="https://gitpython.readthedocs.io/en/stable/intro.html">GitPython library</a> is used to facilitate Git repository access; API reference can be found <a class="reference external" href="https://gitpython.readthedocs.io/en/stable/reference.html">here</a>.</p>
<p>Make sure that any bug fixes or feature additions are properly backed by the appropriate tests.</p>
</div>
<div class="section" id="groovy">
<h3>Groovy<a class="headerlink" href="#groovy" title="Permalink to this headline">¶</a></h3>
<p>The Groovy code can be found in <code class="docutils literal notranslate"><span class="pre">/vars/getCiDriver.groovy</span></code>.
In order to keep Hopic generic, testable and CI-system-independent, avoid writing Groovy code where you can.
Since the Groovy code is specific to Jenkins (and cannot be tested), it should contain as little logic as we can get away with.</p>
<p>In other words: keep your feature/bugfix generic, and only add Groovy if you need an interface to Jenkins (or any information Jenkins provides that cannot be otherwise obtained).</p>
</div>
</div>
<div class="section" id="python-coding-style">
<h2>Python coding style<a class="headerlink" href="#python-coding-style" title="Permalink to this headline">¶</a></h2>
<p>We use <code class="docutils literal notranslate"><span class="pre">flake8</span></code> to enforce PEP8 coding style.</p>
<p>To run it, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tox</span> <span class="o">-</span><span class="n">e</span> <span class="n">flake8</span>
</pre></div>
</div>
<p>The ignore-list can be found in <code class="docutils literal notranslate"><span class="pre">tox.ini</span></code>.</p>
</div>
<div class="section" id="testing-your-changes">
<h2>Testing your changes<a class="headerlink" href="#testing-your-changes" title="Permalink to this headline">¶</a></h2>
<p>To run the full test set, run <code class="docutils literal notranslate"><span class="pre">tox</span></code> with the <code class="docutils literal notranslate"><span class="pre">py3</span></code> environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tox</span> <span class="o">-</span><span class="n">e</span> <span class="n">py3</span>
</pre></div>
</div>
<p>Tests are PyTest-based and are located in <code class="docutils literal notranslate"><span class="pre">hopic/test/</span></code>.
You can provide parameters to PyTest through <code class="docutils literal notranslate"><span class="pre">tox</span></code> by appending <code class="docutils literal notranslate"><span class="pre">--</span> <span class="pre">[OPTIONS]</span></code>.
As an example, using PyTest’s test-substring-matching option <code class="docutils literal notranslate"><span class="pre">-k</span></code> to run tests related to conventional commits:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tox</span> <span class="o">-</span><span class="n">e</span> <span class="n">py3</span> <span class="o">--</span> <span class="o">-</span><span class="n">k</span> <span class="n">conventional</span>
</pre></div>
</div>
<p>To run the tests on all supported Python versions, you can just run Hopic’s <code class="docutils literal notranslate"><span class="pre">test</span></code>-phase, which will start a Docker image for all supported versions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hopic</span> <span class="n">build</span> <span class="o">--</span><span class="n">phase</span> <span class="n">test</span>
</pre></div>
</div>
<div class="section" id="caution-advised">
<h3>Caution advised<a class="headerlink" href="#caution-advised" title="Permalink to this headline">¶</a></h3>
<p>The Hopic repository is designed to be used “live”; your changes will be propagated immediately to a lot of projects.
Submitting changes should therefore not be done lightly and they should be covered by tests as much as possible.</p>
<p>While fixing bugs, create a test case first that cleanly reproduces the bug, which you can use to verify your solution and can be used in the future to prevent regression.</p>
</div>
</div>
<div class="section" id="commits-and-commit-messages">
<h2>Commits and commit messages<a class="headerlink" href="#commits-and-commit-messages" title="Permalink to this headline">¶</a></h2>
<div class="section" id="contents-of-a-commit">
<h3>Contents of a commit<a class="headerlink" href="#contents-of-a-commit" title="Permalink to this headline">¶</a></h3>
<p>Keep commits atomic.
A commit should consist of one “logical” change (that is, one “task” that can’t or shouldn’t sensibly be split up further), and a commit must not fail a build.
For example, if your new feature requires another feature that is not directly related, it can be isolated into its own commit.</p>
</div>
<div class="section" id="commit-message-format">
<h3>Commit message format<a class="headerlink" href="#commit-message-format" title="Permalink to this headline">¶</a></h3>
<p>Commit messages are used to decide which version field to bump, so they should adhere to the <a class="reference external" href="https://www.conventionalcommits.org/en/v1.0.0/">conventional commits specification</a>.</p>
<p>Specific requirements in this repo:</p>
<ul>
<li><p class="first">Commit messages follow this format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">commit</span> <span class="n">title</span>

<span class="o">&lt;</span><span class="n">optional</span> <span class="n">commit</span> <span class="n">body</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">optional</span> <span class="n">footer</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Note the linebreak between the commit title, body and footer</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">&lt;tag&gt;</span></code> should be one of: <code class="docutils literal notranslate"><span class="pre">feat</span></code>, <code class="docutils literal notranslate"><span class="pre">fix</span></code>, <code class="docutils literal notranslate"><span class="pre">build</span></code>, <code class="docutils literal notranslate"><span class="pre">chore</span></code>, <code class="docutils literal notranslate"><span class="pre">ci</span></code>, <code class="docutils literal notranslate"><span class="pre">docs</span></code>, <code class="docutils literal notranslate"><span class="pre">perf</span></code>, <code class="docutils literal notranslate"><span class="pre">refactor</span></code>, <code class="docutils literal notranslate"><span class="pre">revert</span></code>, <code class="docutils literal notranslate"><span class="pre">style</span></code>, <code class="docutils literal notranslate"><span class="pre">test</span></code>, or <code class="docutils literal notranslate"><span class="pre">improvement</span></code>.</p>
</li>
<li><p class="first">The commit title should start with a lowercase and the total commit subject line should not exceed 80 characters.</p>
</li>
<li><p class="first">An optional commit body allows you to elaborate on your change and the rationale for creating it.</p>
</li>
<li><p class="first">The optional footer consists of “key-value”-like items and contains any metadata you want to store in the commit.
The format is inspired by RFC822 e-mail headers and git trailer conventions, e.g.: <code class="docutils literal notranslate"><span class="pre">Addresses:</span> <span class="pre">ISSUE-521</span></code>.</p>
</li>
</ul>
<p>References to tickets/issues should be done using one of the following footers, whichever applies best:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Implements</span><span class="p">:</span> <span class="n">PIPE</span><span class="o">-</span><span class="mi">123</span>
<span class="n">Fixes</span><span class="p">:</span> <span class="n">PIPE</span><span class="o">-</span><span class="mi">123</span>
<span class="n">Addresses</span><span class="p">:</span> <span class="n">PIPE</span><span class="o">-</span><span class="mi">123</span>
</pre></div>
</div>
<p>We enforce adherence to that aforementioned with the tool <a class="reference external" href="https://pypi.org/project/commisery/">Commisery</a>, which can be run locally with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip3</span> <span class="n">install</span> <span class="n">commisery</span>
<span class="n">commisery</span><span class="o">-</span><span class="n">verify</span><span class="o">-</span><span class="n">msg</span> <span class="p">[</span><span class="n">ref</span><span class="p">]</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">[ref]</span></code> is a reference to a commit, following the specification for <code class="docutils literal notranslate"><span class="pre">git-rev-parse(1)</span></code>.
If <code class="docutils literal notranslate"><span class="pre">[ref]</span></code> is omitted, <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> is implied.</p>
</div>
</div>
<div class="section" id="before-creating-a-pull-request">
<h2>Before creating a pull request<a class="headerlink" href="#before-creating-a-pull-request" title="Permalink to this headline">¶</a></h2>
<p>Make sure that:</p>
<ul class="simple">
<li>Commits adhere to the <a class="reference external" href="#Commits-and-commit-messages">commit policy</a></li>
<li>Documentation was added or updated, as appropriate</li>
<li>Your change is covered by <a class="reference external" href="#Testing-your-changes">one or more tests</a></li>
<li>Tests and code style checks pass</li>
</ul>
</div>
<div class="section" id="during-a-pull-request">
<h2>During a pull request<a class="headerlink" href="#during-a-pull-request" title="Permalink to this headline">¶</a></h2>
<div class="section" id="address-review-comments-with-fixups">
<h3>Address review comments with fixups<a class="headerlink" href="#address-review-comments-with-fixups" title="Permalink to this headline">¶</a></h3>
<p>Be kind to your reviewers and don’t force push to your pull request unnecessarily.</p>
<p>To address review comments that should be squashed into an earlier changelist, make the required changes, then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">add</span> <span class="o">&lt;</span><span class="n">changed</span><span class="o">-</span><span class="n">files</span><span class="o">&gt;</span>
<span class="c1"># or:</span>
<span class="c1"># git add -u</span>
<span class="n">git</span> <span class="n">commit</span> <span class="o">--</span><span class="n">fixup</span><span class="o">=&lt;</span><span class="n">ref</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">&lt;ref&gt;</span></code> is a ref to the commit that this fixup should later be squashed into. Refer to <code class="docutils literal notranslate"><span class="pre">gitrevisions(7)</span></code> for the allowed formats (e.g. <code class="docutils literal notranslate"><span class="pre">1a2b3c4</span></code>, <code class="docutils literal notranslate"><span class="pre">:/&quot;part</span> <span class="pre">of</span> <span class="pre">commit</span> <span class="pre">message&quot;</span></code>, etc.)</p>
</div>
<div class="section" id="autosquash-review-comments-when-approved">
<h3>Autosquash review comments when approved<a class="headerlink" href="#autosquash-review-comments-when-approved" title="Permalink to this headline">¶</a></h3>
<p>When all reviewers approve, rebase and (auto-)squash your fixups with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">rebase</span> <span class="o">-</span><span class="n">i</span> <span class="o">--</span><span class="n">autosquash</span> <span class="o">&lt;</span><span class="n">ref</span><span class="o">-</span><span class="n">parent</span><span class="o">&gt;~</span><span class="mi">1</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">&lt;ref&gt;</span></code> this time is the target branch or the <em>first parent</em> of the commit that should receive a fixup, e.g. <code class="docutils literal notranslate"><span class="pre">HEAD~3</span></code>, <code class="docutils literal notranslate"><span class="pre">master</span></code>, <code class="docutils literal notranslate"><span class="pre">1a2b3c4~1</span></code>, etc.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3>Versions</h3>
<ul>
    <li><a href="CONTRIBUTING.html">master</a></li>
    <li><a href="../release_0/index.html">release/0</a></li>
    <li><a href="../release_1/CONTRIBUTING.html">release/1</a></li>
</ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="changes.html" title="Changelog"
             >next</a> |</li>
        <li class="right" >
          <a href="config.html" title="Configuration"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Hopic 1.25.1.dev38+g4f9c649 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020 - 2020, TomTom N.V..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>